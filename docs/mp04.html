<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juan Camilo Martinez Benavides">

<title>Mini-Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Juan Camilo Martinez Benavides </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Selecting a retirement plan is one of the most critical financial decisions for new CUNY faculty, as it has permanent implications for their long-term financial security. Once chosen, the plan cannot be changed, making it essential to consider the potential risks and rewards. This project evaluates the Teachers Retirement System (TRS) and the Optional Retirement Plan (ORP) using historical economic data and Monte Carlo simulations. By modeling contributions, investment returns, and inflation-adjusted benefits, we aim to provide a personalized, data-driven recommendation tailored to individual financial goals and risk tolerance.</p>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<p>The primary goal of this project is to equip new CUNY faculty with an evidence-based recommendation for selecting the optimal retirement plan (TRS or ORP). This involves analyzing historical economic and financial data to assess how each plan performs under different economic conditions. We will utilize the following datasets:</p>
<ul>
<li>Rate of Inflation: Inflation erodes the purchasing power of retirement benefits. For TRS, it determines the annual adjustment in benefits, while for ORP, it impacts the real value of savings and withdrawals.</li>
<li>Rate of Wage Growth: Wage growth directly influences contributions to both plans. For TRS, it affects the final average salary (FAS), which determines retirement payouts. For ORP, higher wages lead to larger investment contributions.</li>
<li>US Equity Market Returns: Equity market performance is crucial for ORP participants, as their investments grow with market returns. US equities represent a significant portion of most retirement portfolios.</li>
<li>International Equity Market Returns: Diversification through international equities reduces risk and enhances returns for ORP participants. It provides a broader perspective on investment performance beyond the US market.</li>
<li>Bond Returns: Bonds are a critical component of retirement portfolios, especially for ORP participants as they approach retirement. Bonds provide stability and reduce volatility in investment returns.</li>
<li>Short-Term Debt Returns: Short-term debt, such as Treasury yields, represents a safe investment option with lower risk. It is particularly relevant for retirees seeking liquidity and capital preservation.</li>
</ul>
<p>By combining insights from these datasets, we will simulate potential retirement outcomes for each plan, identify risks such as running out of funds, and quantify the financial benefits of each option. This comprehensive approach ensures that our recommendation aligns with the diverse financial priorities of faculty members.</p>
<section id="libraries" class="level3">
<h3 class="anchored" data-anchor-id="libraries">Libraries</h3>
<p>The following are the libraries we would use throughtout the project.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)    <span class="co"># For API requests</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)    <span class="co"># For data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)  <span class="co"># For visualization</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)      <span class="co"># For handling time-series data and filling missing values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-collection" class="level2">
<h2 class="anchored" data-anchor-id="data-collection">Data Collection</h2>
<p>For this project, we will use data from two economic and financial data sources:</p>
<ol type="1">
<li><strong>AlphaVantage</strong>: A commercial stock market data provider.</li>
<li><strong>FRED</strong>: The Federal Reserve Economic Data repository maintained by the Federal Reserve Bank of St.&nbsp;Louis.</li>
</ol>
<p>FRED is free to access, but AlphaVantage is a commercial service requiring a subscription. For this mini-project, the free tier of AlphaVantage will suffice.</p>
<section id="links-to-resources" class="level3">
<h3 class="anchored" data-anchor-id="links-to-resources">Links to Resources</h3>
<ul>
<li><a href="https://www.alphavantage.co">AlphaVantage</a></li>
<li><a href="https://fred.stlouisfed.org">FRED (Federal Reserve Economic Data)</a></li>
</ul>
</section>
</section>
<section id="data-collection-1" class="level2">
<h2 class="anchored" data-anchor-id="data-collection-1">DATA COLLECTION</h2>
<p>We would proceed to collect the data from the sources mentioned above. and we would do it on a monthly basis for the last 15 years.</p>
<p>Tod do so, we would use their Apis:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for the FRED API</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fred_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for the AlphaVantage API</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>alphavantage_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read FRED API key from a file</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>fred_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"fred_key.txt"</span>) <span class="co"># Ensure this file contains only your FRED API key</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read AlphaVantage API key from a file</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>alphavantage_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>) <span class="co"># Ensure this file contains only your AlphaVantage API key</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Montly basis for the last 15 years</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>Time_Montly <span class="ot">=</span><span class="fu">as.Date</span>(<span class="st">"2009-01-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ol type="1">
<li>Fetching Rate of Inflation (CPI for NYC Metro Area) from FRED</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Inflation Data from FRED (CPI for NYC Metro Area)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>inflation_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"CUUR0400SA0"</span>,  <span class="co"># CPI for All Urban Consumers: NYC Metro Area</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>inflation_resp <span class="ot">&lt;-</span> inflation_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(inflation_resp)<span class="sc">$</span>observations</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(inflation_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date)),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">inflation_rate =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(inflation_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data.frame(date = as.Date(sapply(inflation_data, function(x)
x$date)), : NAs introduced by coercion</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for the last 15 years</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> inflation_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the rows and check for missing data</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in Inflation Data: "</span>, <span class="fu">nrow</span>(inflation_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in Inflation Data:  190 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rows with Missing Inflation Data: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(inflation_df<span class="sc">$</span>inflation_rate)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows with Missing Inflation Data:  0 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(inflation_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date inflation_rate
185 2024-05-01        334.292
186 2024-06-01        333.662
187 2024-07-01        333.174
188 2024-08-01        333.442
189 2024-09-01        334.265
190 2024-10-01        334.558</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Fetching Rate of Wage Growth from FRED, We’ll use the AHETPI series to measure wage growth.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Wage Growth Data from FRED</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>wage_growth_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"AHETPI"</span>, <span class="co"># Average Hourly Earnings of Production and Nonsupervisory Employees</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>wage_growth_resp <span class="ot">&lt;-</span> wage_growth_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>wage_growth_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(wage_growth_resp)<span class="sc">$</span>observations</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a DataFrame</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(wage_growth_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date)), <span class="co"># Parse date</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_growth =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(wage_growth_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value)) <span class="co"># Convert to numeric</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the last 15–20 years</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> wage_growth_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the data</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>total_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(wage_growth_df)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>missing_rows <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(wage_growth_df<span class="sc">$</span>wage_growth))</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Output results</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in Wage Growth Data: "</span>, total_rows, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in Wage Growth Data:  190 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rows with Missing Wage Growth Data: "</span>, missing_rows, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows with Missing Wage Growth Data:  0 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the first few rows of the dataset</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(wage_growth_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date wage_growth
185 2024-05-01       29.95
186 2024-06-01       30.07
187 2024-07-01       30.16
188 2024-08-01       30.26
189 2024-09-01       30.36
190 2024-10-01       30.48</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Fetching US Equity Market Returns from AlphaVantage</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch US Equity Market Data from AlphaVantage</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>us_equity_req <span class="ot">&lt;-</span> <span class="fu">request</span>(alphavantage_url) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"SPY"</span>, <span class="co"># S&amp;P 500 ETF</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> alphavantage_key</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>us_equity_resp <span class="ot">&lt;-</span> us_equity_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>us_equity_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(us_equity_resp)<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(us_equity_data)), <span class="co"># Extract dates</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">us_equity_close =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(us_equity_data, <span class="cf">function</span>(x) x<span class="sc">$</span><span class="st">`</span><span class="at">5. adjusted close</span><span class="st">`</span>)) <span class="co"># Extract adjusted close prices</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize dates to the first of each month</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>us_equity_df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(us_equity_df<span class="sc">$</span>date, <span class="st">"%Y-%m-01"</span>))</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the past 15 years</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> us_equity_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Data Quality</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in US Equity Data: "</span>, <span class="fu">nrow</span>(us_equity_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in US Equity Data:  192 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rows with Missing US Equity Data: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(us_equity_df<span class="sc">$</span>us_equity_close)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows with Missing US Equity Data:  0 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview Data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(us_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date us_equity_close
187 2009-06-01         69.2692
188 2009-05-01         69.3159
189 2009-04-01         65.4879
190 2009-03-01         59.5698
191 2009-02-01         54.9799
192 2009-01-01         61.5986</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Fetching International Equity Market Returns from AlphaVantage</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch International Equity Market Data from AlphaVantage</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>intl_req <span class="ot">&lt;-</span> <span class="fu">request</span>(alphavantage_url) <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"VEA"</span>, <span class="co"># Vanguard FTSE Developed Markets ETF</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> alphavantage_key</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>intl_resp <span class="ot">&lt;-</span> intl_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>intl_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(intl_resp)<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the fetched data into a data frame</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(intl_data)),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">intl_equity_close =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(intl_data, <span class="cf">function</span>(x) x<span class="sc">$</span><span class="st">`</span><span class="at">5. adjusted close</span><span class="st">`</span>))</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize dates to the first of each month</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>intl_equity_df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(intl_equity_df<span class="sc">$</span>date, <span class="st">"%Y-%m-01"</span>))</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the past 15 years</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> intl_equity_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Print information about the dataset</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in International Equity Data: "</span>, <span class="fu">nrow</span>(intl_equity_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in International Equity Data:  192 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rows with Missing International Equity Data: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(intl_equity_df<span class="sc">$</span>intl_equity_close)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows with Missing International Equity Data:  0 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(intl_equity_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        date intl_equity_close
1 2024-12-01           50.5600
2 2024-11-01           50.3000
3 2024-10-01           50.1000
4 2024-09-01           52.8100
5 2024-08-01           52.2448
6 2024-07-01           50.7689</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Fetching Bond Returns from AlphaVantage</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Bond Yield Data (Daily)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>bond_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"DGS10"</span>, <span class="co"># 10-Year Treasury Yield</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>bond_resp <span class="ot">&lt;-</span> bond_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>bond_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(bond_resp)<span class="sc">$</span>observations</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(bond_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date)),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">bond_yield =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(bond_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value))</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data.frame(date = as.Date(sapply(bond_data, function(x) x$date)), :
NAs introduced by coercion</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of Fetched Data</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in Bond Yield Data: "</span>, <span class="fu">nrow</span>(bond_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in Bond Yield Data:  16415 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rows with Missing Bond Yield Data: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(bond_df<span class="sc">$</span>bond_yield)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows with Missing Bond Yield Data:  700 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Downsample to Monthly Averages</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)) <span class="sc">|&gt;</span><span class="co"># Extract year-month for grouping</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_yield =</span> <span class="fu">mean</span>(bond_yield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Average yield for the month</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>))) <span class="sc">|&gt;</span><span class="co"># Convert back to Date</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, bond_yield)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the last 15 years</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary after Downsampling</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in Bond Yield Data (Monthly): "</span>, <span class="fu">nrow</span>(bond_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in Bond Yield Data (Monthly):  192 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rows with Missing Bond Yield Data: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(bond_df<span class="sc">$</span>bond_yield)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows with Missing Bond Yield Data:  0 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the Data</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">tail</span>(bond_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  date       bond_yield
  &lt;date&gt;          &lt;dbl&gt;
1 2024-07-01       4.25
2 2024-08-01       3.87
3 2024-09-01       3.72
4 2024-10-01       4.10
5 2024-11-01       4.36
6 2024-12-01       4.19</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Fetching Short-Term Debt Returns from AlphaVantage: for this dataset, we need to downsample the daily data to monthly averages to align with the other datasets.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Short-Term Debt Data (2-Year Treasury Yield) - Attempt Monthly Query</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>short_term_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"DGS2"</span>, <span class="co"># 2-Year Treasury Yield</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">frequency =</span> <span class="st">"m"</span>, <span class="co"># Request monthly data directly</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>short_term_resp <span class="ot">&lt;-</span> short_term_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>short_term_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(short_term_resp)<span class="sc">$</span>observations</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON to DataFrame</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>short_term_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(short_term_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">short_term_yield =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(short_term_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value))</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data.frame(date = as.Date(sapply(short_term_data, function(x)
x$date), : NAs introduced by coercion</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the Last 15 Years</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>short_term_df <span class="ot">&lt;-</span> short_term_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Total Rows and Missing Data</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in Short-Term Yield Data (Monthly): "</span>, <span class="fu">nrow</span>(short_term_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in Short-Term Yield Data (Monthly):  192 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Rows with Missing Short-Term Yield Data: "</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(short_term_df<span class="sc">$</span>short_term_yield)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows with Missing Short-Term Yield Data:  1 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the Data</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(short_term_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date short_term_yield
187 2024-07-01             4.50
188 2024-08-01             3.97
189 2024-09-01             3.62
190 2024-10-01             3.97
191 2024-11-01             4.26
192 2024-12-01               NA</code></pre>
</div>
</div>
</section>
<section id="data-preprocessing-and-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing-and-cleaning">Data Preprocessing and Cleaning</h2>
<p>Now that we have collected the data, we can proceed to the next step, which is data preprocessing. We we gonna unify the data and deal with missing values by using bootstrapping.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries for analysis and visualization</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to cap outliers</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>cap_outlier <span class="ot">&lt;-</span> <span class="cf">function</span>(x, lower_bound, upper_bound) {</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&lt;</span> lower_bound] <span class="ot">&lt;-</span> lower_bound</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  x[x <span class="sc">&gt;</span> upper_bound] <span class="ot">&lt;-</span> upper_bound</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize dates to the first of each month for all datasets</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">list</span>(inflation_df, wage_growth_df, us_equity_df, intl_equity_df, bond_df, short_term_df)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">lapply</span>(datasets, <span class="cf">function</span>(df) {</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(df<span class="sc">$</span>date, <span class="st">"%Y-%m-01"</span>))</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Unpack datasets back</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> datasets[[<span class="dv">1</span>]]</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> datasets[[<span class="dv">2</span>]]</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> datasets[[<span class="dv">3</span>]]</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> datasets[[<span class="dv">4</span>]]</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> datasets[[<span class="dv">5</span>]]</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>short_term_df <span class="ot">&lt;-</span> datasets[[<span class="dv">6</span>]]</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create master date sequence</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2009-01-01"</span>)</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"2024-10-01"</span>))</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>date_seq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="at">from =</span> start_date, <span class="at">to =</span> end_date, <span class="at">by =</span> <span class="st">"month"</span>))</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Expected number of rows (months) over 15 years: "</span>, <span class="fu">nrow</span>(date_seq), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Expected number of rows (months) over 15 years:  190 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform left joins for all datasets</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> date_seq <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(inflation_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wage_growth_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(us_equity_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(intl_equity_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bond_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(short_term_df, <span class="at">by =</span> <span class="st">"date"</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing data</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total Rows in Combined Dataset: "</span>, <span class="fu">nrow</span>(combined_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total Rows in Combined Dataset:  190 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>missing_summary <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Missing Data Summary:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing Data Summary:</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  date inflation_rate wage_growth us_equity_close intl_equity_close bond_yield
1    0              0           0               0                 0          0
  short_term_yield
1                0</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply bootstrapping for missing values</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Applying bootstrap for missing data...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Applying bootstrap for missing data...</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflation_rate =</span> <span class="fu">replace</span>(inflation_rate,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">is.na</span>(inflation_rate),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">sample</span>(<span class="fu">na.omit</span>(inflation_rate), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(inflation_rate)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_growth =</span> <span class="fu">replace</span>(wage_growth,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">is.na</span>(wage_growth),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">sample</span>(<span class="fu">na.omit</span>(wage_growth), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(wage_growth)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity_close =</span> <span class="fu">replace</span>(us_equity_close,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">is.na</span>(us_equity_close),</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">sample</span>(<span class="fu">na.omit</span>(us_equity_close), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(us_equity_close)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl_equity_close =</span> <span class="fu">replace</span>(intl_equity_close,</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">is.na</span>(intl_equity_close),</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">sample</span>(<span class="fu">na.omit</span>(intl_equity_close), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(intl_equity_close)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_yield =</span> <span class="fu">replace</span>(bond_yield,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">is.na</span>(bond_yield),</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">sample</span>(<span class="fu">na.omit</span>(bond_yield), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(bond_yield)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_term_yield =</span> <span class="fu">replace</span>(short_term_yield,</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">is.na</span>(short_term_yield),</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">sample</span>(<span class="fu">na.omit</span>(short_term_yield), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(short_term_yield)), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle outliers by capping them</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflation_rate =</span> <span class="fu">cap_outlier</span>(inflation_rate, </span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lower_bound =</span> <span class="fu">quantile</span>(inflation_rate, <span class="fl">0.01</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">upper_bound =</span> <span class="fu">quantile</span>(inflation_rate, <span class="fl">0.99</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_growth =</span> <span class="fu">cap_outlier</span>(wage_growth, </span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lower_bound =</span> <span class="fu">quantile</span>(wage_growth, <span class="fl">0.01</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>                              <span class="at">upper_bound =</span> <span class="fu">quantile</span>(wage_growth, <span class="fl">0.99</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity_close =</span> <span class="fu">cap_outlier</span>(us_equity_close, </span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">lower_bound =</span> <span class="fu">quantile</span>(us_equity_close, <span class="fl">0.01</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">upper_bound =</span> <span class="fu">quantile</span>(us_equity_close, <span class="fl">0.99</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl_equity_close =</span> <span class="fu">cap_outlier</span>(intl_equity_close, </span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">lower_bound =</span> <span class="fu">quantile</span>(intl_equity_close, <span class="fl">0.01</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">upper_bound =</span> <span class="fu">quantile</span>(intl_equity_close, <span class="fl">0.99</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_yield =</span> <span class="fu">cap_outlier</span>(bond_yield, </span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>                             <span class="at">lower_bound =</span> <span class="fu">quantile</span>(bond_yield, <span class="fl">0.01</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>                             <span class="at">upper_bound =</span> <span class="fu">quantile</span>(bond_yield, <span class="fl">0.99</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_term_yield =</span> <span class="fu">cap_outlier</span>(short_term_yield, </span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lower_bound =</span> <span class="fu">quantile</span>(short_term_yield, <span class="fl">0.01</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">upper_bound =</span> <span class="fu">quantile</span>(short_term_yield, <span class="fl">0.99</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate the final dataset</span></span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"After handling missing values and outliers:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>After handling missing values and outliers:</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>missing_summary_after <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_summary_after)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  date inflation_rate wage_growth us_equity_close intl_equity_close bond_yield
1    0              0           0               0                 0          0
  short_term_yield
1                0</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can now proceed with additional analysis or visualization</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date inflation_rate wage_growth us_equity_close intl_equity_close
185 2024-05-01        334.268      29.950        524.0620          50.10910
186 2024-06-01        333.662      30.070        542.5534          49.28300
187 2024-07-01        333.174      30.160        549.1232          50.76890
188 2024-08-01        333.442      30.260        561.9538          50.93125
189 2024-09-01        334.265      30.271        562.6893          50.93125
190 2024-10-01        334.268      30.271        562.6893          50.10000
    bond_yield short_term_yield
185   4.482273             4.86
186   4.305263             4.74
187   4.248636             4.50
188   3.870909             3.97
189   3.723500             3.62
190   4.095455             3.97</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date inflation_rate wage_growth us_equity_close intl_equity_close
185 2024-05-01        334.268      29.950        524.0620          50.10910
186 2024-06-01        333.662      30.070        542.5534          49.28300
187 2024-07-01        333.174      30.160        549.1232          50.76890
188 2024-08-01        333.442      30.260        561.9538          50.93125
189 2024-09-01        334.265      30.271        562.6893          50.93125
190 2024-10-01        334.268      30.271        562.6893          50.10000
    bond_yield short_term_yield
185   4.482273             4.86
186   4.305263             4.74
187   4.248636             4.50
188   3.870909             3.97
189   3.723500             3.62
190   4.095455             3.97</code></pre>
</div>
</div>
</section>
<section id="initial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="initial-analysis">Initial Analysis</h2>
<p>Now that we have a clean dataset, we can perform some initial analysis to understand the trends and relationships between the variables.</p>
<p>We will visualize the data using line plots and we going to display them in pairs to compare the trends between the variables. so it would be inflation rate and wage growth, US equity and International equity, and Bond Yield and Short-Term Yield.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot for Inflation Rate and Wage Growth with corrected labels and separate y-axes</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inflation Rate</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> inflation_rate), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Inflation Rate Value (NYC)"</span>,  <span class="co"># Corrected label for inflation rate</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">*</span> <span class="dv">0</span>, <span class="at">name =</span> <span class="st">" "</span>)  <span class="co"># Create empty secondary axis for separation</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wage Growth (scaled for visibility)</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> wage_growth <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Inflation Rate Value (NYC)"</span>,  <span class="co"># Corrected label for wage growth</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Wage Growth (Hourly Earnings in $)"</span>)  <span class="co"># Corrected secondary label</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Inflation Rate and Wage Growth Over Time"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot for US Equity and International Equity</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># US Equity Return</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> us_equity_close), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span>  </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"US Equity Return (Adjusted Close)"</span>  </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># International Equity Return (scaled for visibility)</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> intl_equity_close <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span>  </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"US Equity Return (Adjusted Close)"</span>,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Intl Equity Return"</span>)  </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US and International Equity Returns Over Time"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot for Bond Yield and Short-Term Yield </span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bond Yield</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> bond_yield <span class="sc">*</span> <span class="dv">2</span>), <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span>  </span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Bond Yield (%)"</span>, </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">2</span>, <span class="at">name =</span> <span class="st">"Bond Yield (%)"</span>)  </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Short-Term Yield</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> short_term_yield <span class="sc">*</span> <span class="dv">2</span>), <span class="at">color =</span> <span class="st">"brown"</span>) <span class="sc">+</span>  </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Short-Term Yield (%)"</span>, </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">2</span>, <span class="at">name =</span> <span class="st">"Short-Term Yield (%)"</span>)  </span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bond Yield and Short-Term Yield Over Time"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"brown"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display all three plots</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="correlation-matrix" class="level3">
<h3 class="anchored" data-anchor-id="correlation-matrix">Correlation matrix</h3>
<p>We will calculate the correlation matrix to understand the relationships between the variables. This will help us identify any significant correlations that can inform our analysis and decision-making process.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the necessary library</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only numeric columns</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>numeric_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the correlation matrix</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_data, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the correlation matrix using ggcorrplot</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix, </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"lower"</span>,          <span class="co"># Only show the lower triangle</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">lab =</span> <span class="cn">TRUE</span>,              <span class="co"># Show correlation coefficient labels</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">lab_size =</span> <span class="dv">3</span>,            <span class="co"># Adjust label size</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"circle"</span>,       <span class="co"># Use circle shapes for correlation values</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"white"</span>, <span class="st">"blue"</span>), <span class="co"># Color scale</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">"Correlation Matrix"</span>, <span class="co"># Plot title</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_minimal</span>(), <span class="co"># Minimalistic theme</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">tl.cex =</span> <span class="dv">12</span>,             <span class="co"># Title label size</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">tl.col =</span> <span class="st">"black"</span>         <span class="co"># Title text color</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="key-findings-on-economic-factors-and-retirement-planning" class="level1">
<h1>Key Findings on Economic Factors and Retirement Planning</h1>
<p>In this analysis, we examine the relationships between several key economic factors, including inflation, wage growth, stock market returns (both US and international), bond yields, and short-term debt yields. Understanding how these factors are correlated can provide valuable insights for making informed financial decisions, particularly for retirement planning.</p>
<section id="key-findings" class="level2">
<h2 class="anchored" data-anchor-id="key-findings">Key Findings:</h2>
<section id="inflation-rate-and-wage-growth" class="level3">
<h3 class="anchored" data-anchor-id="inflation-rate-and-wage-growth">1. Inflation Rate and Wage Growth:</h3>
<ul>
<li><strong>Correlation</strong>: 0.98 (Very strong)</li>
<li><strong>Interpretation</strong>: When inflation increases, wage growth tends to follow suit. This suggests that as the cost of living rises, your wages are likely to increase as well, which helps you keep up with inflation.</li>
</ul>
</section>
<section id="stock-market-returns" class="level3">
<h3 class="anchored" data-anchor-id="stock-market-returns">2. Stock Market Returns:</h3>
<section id="us-and-international-markets" class="level4">
<h4 class="anchored" data-anchor-id="us-and-international-markets">US and International Markets:</h4>
<ul>
<li><strong>Correlation</strong>: 0.97 (Very strong)</li>
<li><strong>Interpretation</strong>: US and international stock markets have a highly positive correlation, meaning they often move in the same direction. This makes diversification between US and international markets a good strategy for reducing risk while maintaining growth potential.</li>
</ul>
</section>
<section id="us-equity-returns-and-bond-yields" class="level4">
<h4 class="anchored" data-anchor-id="us-equity-returns-and-bond-yields">US Equity Returns and Bond Yields:</h4>
<ul>
<li><strong>Correlation</strong>: 0.68 (Moderate)</li>
<li><strong>Interpretation</strong>: The moderate correlation suggests that when US stocks perform well, bond yields may not follow the same trend. Investors need to balance their portfolios between stocks and bonds, taking into account their risk tolerance and time horizon.</li>
</ul>
</section>
</section>
<section id="inflation-and-other-variables" class="level3">
<h3 class="anchored" data-anchor-id="inflation-and-other-variables">3. Inflation and Other Variables:</h3>
<section id="inflation-and-us-stock-returns" class="level4">
<h4 class="anchored" data-anchor-id="inflation-and-us-stock-returns">Inflation and US Stock Returns:</h4>
<ul>
<li><strong>Correlation</strong>: 0.92 (Strong)</li>
<li><strong>Interpretation</strong>: Inflation and US stock returns are highly correlated. As inflation rises, US stocks tend to perform well, making stocks a potential hedge against inflation.</li>
</ul>
</section>
<section id="inflation-and-international-stock-returns" class="level4">
<h4 class="anchored" data-anchor-id="inflation-and-international-stock-returns">Inflation and International Stock Returns:</h4>
<ul>
<li><strong>Correlation</strong>: 0.97 (Very strong)</li>
<li><strong>Interpretation</strong>: Like US stocks, international stocks also tend to rise with inflation, making global diversification a viable strategy for mitigating inflation risk.</li>
</ul>
</section>
<section id="inflation-and-bond-yields" class="level4">
<h4 class="anchored" data-anchor-id="inflation-and-bond-yields">Inflation and Bond Yields:</h4>
<ul>
<li><strong>Correlation</strong>: 0.72 (Moderate)</li>
<li><strong>Interpretation</strong>: Inflation and bond yields are moderately correlated. Rising inflation generally leads to higher bond yields, which can help protect fixed-income investments from losing purchasing power.</li>
</ul>
</section>
</section>
<section id="bond-yield-and-short-term-yield" class="level3">
<h3 class="anchored" data-anchor-id="bond-yield-and-short-term-yield">4. Bond Yield and Short-Term Yield:</h3>
<ul>
<li><strong>Correlation</strong>: 0.75 (Strong)</li>
<li><strong>Interpretation</strong>: Bond yields and short-term yields tend to move in the same direction, which suggests that both types of bonds respond similarly to changes in interest rates.</li>
</ul>
</section>
</section>
<section id="implications-for-retirement-planning" class="level2">
<h2 class="anchored" data-anchor-id="implications-for-retirement-planning">Implications for Retirement Planning:</h2>
<ul>
<li><p><strong>Wage Growth and Inflation</strong>: The close correlation between wage growth and inflation means that as prices rise, your income should likely increase, helping you maintain purchasing power in retirement.</p></li>
<li><p><strong>Equity Market Performance</strong>: The strong correlation between US and international equity returns allows for diversification between these markets without sacrificing performance.</p></li>
<li><p><strong>Bonds and Short-Term Yields</strong>: Understanding the relationship between bonds and short-term debt yields is crucial for managing fixed-income investments in a rising interest rate environment.</p></li>
</ul>
</section>
<section id="historical-comparison-of-trs-and-orp" class="level2">
<h2 class="anchored" data-anchor-id="historical-comparison-of-trs-and-orp">Historical Comparison of TRS and ORP</h2>
<section id="trs-vs.-orp-retirement-comparison" class="level3">
<h3 class="anchored" data-anchor-id="trs-vs.-orp-retirement-comparison">TRS vs.&nbsp;ORP: Retirement Comparison</h3>
<p>In this section, we compare the <strong>Teachers Retirement System (TRS)</strong> and the <strong>Optional Retirement Plan (ORP)</strong> for the first month of retirement, assuming:</p>
<ul>
<li><strong>Career Timeline</strong>: Employee joined CUNY in <strong>January 2009</strong> and retired in <strong>November 2024</strong>.</li>
<li><strong>Starting Salary</strong>: $50,000 in <strong>2009</strong>, adjusted annually for historical wage growth (using actual wage growth data).</li>
<li><strong>Fixed Plan Parameters</strong>: Contribution rates and retirement benefits remain constant during the employee’s career.</li>
</ul>
</section>
<section id="plan-overviews" class="level3">
<h3 class="anchored" data-anchor-id="plan-overviews">Plan Overviews</h3>
<section id="trs-teachers-retirement-system" class="level4">
<h4 class="anchored" data-anchor-id="trs-teachers-retirement-system">TRS (Teachers Retirement System)</h4>
<ul>
<li><strong>Defined-Benefit Plan</strong>:
<ul>
<li>Retirement income is based on the <strong>Final Average Salary (FAS)</strong> and years of service.</li>
</ul></li>
<li><strong>Retirement Benefit Formula</strong>:
<ul>
<li>( = () ), capped at <strong>30 years of service</strong>.</li>
</ul></li>
<li><strong>Inflation Adjustment</strong>:
<ul>
<li><strong>Annual increase</strong> of <strong>50% of CPI</strong>, capped between <strong>1% and 3%</strong> annually.</li>
</ul></li>
</ul>
</section>
<section id="orp-optional-retirement-plan" class="level4">
<h4 class="anchored" data-anchor-id="orp-optional-retirement-plan">ORP (Optional Retirement Plan)</h4>
<ul>
<li><strong>Defined-Contribution Plan</strong>:
<ul>
<li>Employee and employer contribute to an individual retirement account, invested in a <strong>Fidelity Freedom Fund</strong>.</li>
</ul></li>
<li><strong>Contributions</strong>:
<ul>
<li><strong>Employee</strong>: Salary-based contribution (e.g., 3% for salaries ≤$45,000; 3.5% for $45,001–$55,000).</li>
<li><strong>Employer</strong>: 8% for the first 7 years, then 10% for subsequent years.</li>
</ul></li>
<li><strong>Investment Returns</strong>:
<ul>
<li>US equities: <strong>7%</strong>, International equities: <strong>6%</strong>, Bonds: <strong>4%</strong>.</li>
</ul></li>
<li><strong>Retirement Strategy</strong>: Withdraw <strong>4%</strong> of accumulated funds annually at retirement.</li>
</ul>
<hr>
</section>
</section>
<section id="step-by-step-analysis" class="level3">
<h3 class="anchored" data-anchor-id="step-by-step-analysis">Step-by-Step Analysis</h3>
<section id="starting-salary" class="level4">
<h4 class="anchored" data-anchor-id="starting-salary">1. <strong>Starting Salary</strong></h4>
<ul>
<li>The employee’s starting salary is <strong>$50,000</strong> in <strong>January 2009</strong>.</li>
<li>The salary increases <strong>annually</strong> based on historical wage growth data.</li>
</ul>
</section>
<section id="trs-benefit-calculation" class="level4">
<h4 class="anchored" data-anchor-id="trs-benefit-calculation">2. <strong>TRS Benefit Calculation</strong></h4>
<ul>
<li><strong>Final Average Salary (FAS)</strong>:
<ul>
<li>Calculated as the average of the last three years of salary, adjusted for wage growth.</li>
</ul></li>
<li><strong>Years of Service</strong>:
<ul>
<li>The employee works for <strong>15 years</strong> (from 2009 to 2024), and their pension benefit is calculated based on <strong>15 years of service</strong>.</li>
</ul></li>
<li><strong>Monthly Pension</strong>:
<ul>
<li>The pension benefit is calculated as ( () ) (since the employee works 15 years).</li>
</ul></li>
<li><strong>Inflation Adjustment</strong>:
<ul>
<li>The pension benefit will be <strong>inflation-adjusted</strong> annually based on the <strong>CPI</strong>. The adjustment will be between <strong>1% and 3%</strong> per year, applied each September after retirement.</li>
</ul></li>
</ul>
</section>
<section id="orp-benefit-calculation" class="level4">
<h4 class="anchored" data-anchor-id="orp-benefit-calculation">3. <strong>ORP Benefit Calculation</strong></h4>
<ul>
<li><strong>Monthly Contributions</strong>:
<ul>
<li>The employee and employer contributions are calculated based on the <strong>salary brackets</strong> (e.g., 3% for salaries ≤$45,000).</li>
<li>Contributions are made monthly throughout the employee’s <strong>15-year</strong> career.</li>
</ul></li>
<li><strong>Investment Growth</strong>:
<ul>
<li>The employee’s contributions grow using the average market returns over time:
<ul>
<li>US equities: <strong>7%</strong>, International equities: <strong>6%</strong>, Bonds: <strong>4%</strong>.</li>
</ul></li>
</ul></li>
<li><strong>Retirement Withdrawal</strong>:
<ul>
<li>The employee can begin withdrawing funds from their ORP account upon retirement.</li>
<li>A general rule of thumb is to withdraw <strong>4%</strong> annually from the accumulated balance at retirement.</li>
</ul></li>
</ul>
<hr>
<p>The following code snippets will calculate the retirement benefits for both TRS and ORP based on the assumptions outlined above. We will compare the monthly benefits and accumulated funds for each plan to provide a comprehensive analysis of the retirement options.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the dataset 'combined_data' already exists</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage growth for inflation_rate</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>inflation_rate_growth <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(combined_data<span class="sc">$</span>inflation_rate) <span class="sc">/</span> <span class="fu">head</span>(combined_data<span class="sc">$</span>inflation_rate, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage growth for wage_growth</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>wage_growth_growth <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(combined_data<span class="sc">$</span>wage_growth) <span class="sc">/</span> <span class="fu">head</span>(combined_data<span class="sc">$</span>wage_growth, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage growth for us_equity_close</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>us_equity_growth <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(combined_data<span class="sc">$</span>us_equity_close) <span class="sc">/</span> <span class="fu">head</span>(combined_data<span class="sc">$</span>us_equity_close, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentage growth for intl_equity_close</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>intl_equity_growth <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(combined_data<span class="sc">$</span>intl_equity_close) <span class="sc">/</span> <span class="fu">head</span>(combined_data<span class="sc">$</span>intl_equity_close, <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co"># For bond_yield and short_term_yield, just divide by 100 to convert to decimals</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>bond_yield <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>bond_yield <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>short_term_yield <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>short_term_yield <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new dataset with only the percentage growth columns</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>percentages <span class="ot">&lt;-</span> combined_data[, <span class="fu">c</span>(<span class="st">'date'</span>, <span class="st">'inflation_rate_growth'</span>, <span class="st">'wage_growth_growth'</span>, </span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">'us_equity_growth'</span>, <span class="st">'intl_equity_growth'</span>, </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">'bond_yield'</span>, <span class="st">'short_term_yield'</span>)]</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the first month (first row)</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>percentages <span class="ot">&lt;-</span> percentages[<span class="sc">-</span><span class="dv">1</span>, ]</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the results</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(percentages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date inflation_rate_growth wage_growth_growth us_equity_growth
2   2009-02-01          0.000000e+00       0.0000000000    -3.622939e-03
3   2009-03-01          1.326105e-04       0.0003568841     0.000000e+00
4   2009-04-01          2.544201e-03       0.0010810811     6.700512e-02
5   2009-05-01          3.015006e-03       0.0005399568     5.845355e-02
6   2009-06-01          5.938682e-03       0.0016189962    -6.737271e-04
7   2009-07-01         -1.732882e-03       0.0016163793     7.460603e-02
8   2009-08-01          1.822456e-03       0.0043033889     3.693857e-02
9   2009-09-01          1.864620e-03       0.0016068559     3.545818e-02
10  2009-10-01          6.945264e-04       0.0021390374    -1.922586e-02
11  2009-11-01         -3.261555e-03       0.0032017076     6.160715e-02
12  2009-12-01         -1.916005e-03       0.0021276596     1.907201e-02
13  2010-01-01          3.109796e-03       0.0021231423    -3.634293e-02
14  2010-02-01          8.636795e-04       0.0015889831     3.119505e-02
15  2010-03-01          2.861308e-03       0.0000000000     6.090499e-02
16  2010-04-01          1.779819e-03       0.0026441036     1.547038e-02
17  2010-05-01          9.719623e-04       0.0026371308    -7.945481e-02
18  2010-06-01         -1.219419e-03       0.0010520779    -5.174291e-02
19  2010-07-01          8.320258e-04       0.0005254861     6.830035e-02
20  2010-08-01          8.674790e-04       0.0036764706    -4.498046e-02
21  2010-09-01         -6.274743e-04       0.0000000000     8.955377e-02
22  2010-10-01          1.463520e-03       0.0047095761     3.820246e-02
23  2010-11-01         -1.668862e-04       0.0005208333     0.000000e+00
24  2010-12-01          1.849588e-03       0.0005205622     6.684401e-02
25  2011-01-01          4.809056e-03       0.0057232050     2.329955e-02
26  2011-02-01          5.745040e-03      -0.0010346611     3.473746e-02
27  2011-03-01          9.477300e-03       0.0000000000     1.074389e-04
28  2011-04-01          5.645354e-03       0.0025893320     2.896088e-02
29  2011-05-01          2.980201e-03       0.0025826446    -1.121447e-02
30  2011-06-01         -1.929843e-03       0.0000000000    -1.688645e-02
31  2011-07-01         -1.183821e-03       0.0030911901    -2.000474e-02
32  2011-08-01          1.830513e-03       0.0000000000    -5.497566e-02
33  2011-09-01          4.053071e-03       0.0010272214    -6.945000e-02
34  2011-10-01          2.094725e-04       0.0035915854     1.091476e-01
35  2011-11-01         -1.849953e-03       0.0000000000    -4.063205e-03
36  2011-12-01         -2.858754e-03       0.0005112474     1.043932e-02
37  2012-01-01          3.783146e-03       0.0010219724     4.637443e-02
38  2012-02-01          4.432702e-03       0.0000000000     4.340591e-02
39  2012-03-01          8.887150e-03       0.0025523226     3.215672e-02
40  2012-04-01          2.249622e-03       0.0020366599    -6.675855e-03
41  2012-05-01          2.115574e-03      -0.0005081301    -6.005606e-02
42  2012-06-01         -1.510386e-03       0.0020335536     4.052887e-02
43  2012-07-01         -3.472267e-03       0.0015220700     1.182942e-02
44  2012-08-01          4.778066e-03       0.0000000000     2.505305e-02
45  2012-09-01          4.643757e-03       0.0025329281     2.535671e-02
46  2012-10-01          3.772166e-03       0.0000000000    -1.819820e-02
47  2012-11-01         -7.490445e-03       0.0030318343     5.659034e-03
48  2012-12-01         -5.047040e-03       0.0030226700     8.998603e-03
49  2013-01-01          3.146158e-03       0.0015067805     5.119033e-02
50  2013-02-01          7.887987e-03       0.0025075226     1.275907e-02
51  2013-03-01          3.904602e-03       0.0005002501     3.797501e-02
52  2013-04-01         -9.765998e-05       0.0020000000     1.921221e-02
53  2013-05-01          2.085032e-03       0.0004990020     2.361012e-02
54  2013-06-01          1.050941e-03       0.0034912718    -1.336030e-02
55  2013-07-01          4.825867e-04       0.0009940358     5.167636e-02
56  2013-08-01          1.057794e-03       0.0019860973    -2.999192e-02
57  2013-09-01          2.345820e-03       0.0024777007     3.168081e-02
58  2013-10-01         -6.156545e-04       0.0009886307     4.630679e-02
59  2013-11-01         -3.573840e-03       0.0029629630     2.963831e-02
60  2013-12-01         -2.413689e-04       0.0019694732     2.589575e-02
61  2014-01-01          2.587930e-03       0.0019656020    -3.524821e-02
62  2014-02-01          3.831741e-03       0.0058852379     4.551566e-02
63  2014-03-01          6.220172e-03      -0.0004875670     8.310573e-03
64  2014-04-01          2.994663e-03       0.0004878049     6.951211e-03
65  2014-05-01          6.430144e-03       0.0014627011     2.320638e-02
66  2014-06-01          1.102134e-03       0.0024342746     2.063342e-02
67  2014-07-01          9.684789e-04       0.0009713453    -1.343749e-02
68  2014-08-01         -7.856109e-04       0.0024260068     3.946383e-02
69  2014-09-01          1.075892e-03       0.0004840271    -1.379126e-02
70  2014-10-01         -1.116071e-03       0.0014513788     2.355067e-02
71  2014-11-01         -5.917649e-03       0.0033816425     2.747214e-02
72  2014-12-01         -4.683207e-03      -0.0028887819    -2.560075e-03
73  2015-01-01         -3.249754e-03       0.0043457267    -2.962936e-02
74  2015-02-01          6.000386e-03       0.0019230769     5.620436e-02
75  2015-03-01          8.100172e-03       0.0033589251    -1.574480e-02
76  2015-04-01          2.532169e-03       0.0004782401     9.834278e-03
77  2015-05-01          7.944631e-03       0.0028680688     1.285576e-02
78  2015-06-01          4.299279e-04       0.0009532888    -2.009986e-02
79  2015-07-01          2.897697e-03       0.0014285714     2.214741e-02
80  2015-08-01         -1.236533e-03       0.0033285782    -6.134457e-02
81  2015-09-01         -1.961289e-03      -0.0004739336    -2.498985e-02
82  2015-10-01          3.439001e-04       0.0047415837     8.528627e-02
83  2015-11-01         -2.422843e-03       0.0009438414     3.654735e-03
84  2015-12-01         -1.292313e-03       0.0009429514    -1.717930e-02
85  2016-01-01          4.789799e-03       0.0037682525    -4.978633e-02
86  2016-02-01          9.035159e-04       0.0009385265    -8.261942e-04
87  2016-03-01          2.381332e-03       0.0028129395     6.724268e-02
88  2016-04-01          4.828772e-03       0.0032725573     3.941464e-03
89  2016-05-01          5.134049e-03       0.0004659832     1.701131e-02
90  2016-06-01          1.504912e-03       0.0023288309     3.497450e-03
91  2016-07-01          5.921975e-04       0.0027881041     3.647104e-02
92  2016-08-01          4.952189e-04       0.0009267841     1.197755e-03
93  2016-09-01          2.961794e-03       0.0013888889     7.784834e-05
94  2016-10-01          2.660151e-03       0.0036985668    -1.733712e-02
95  2016-11-01         -1.796740e-03       0.0000000000     3.683851e-02
96  2016-12-01          2.726019e-04       0.0023030861     2.028320e-02
97  2017-01-01          5.202071e-03       0.0022977941     1.789483e-02
98  2017-02-01          5.733332e-03       0.0013755158     3.929117e-02
99  2017-03-01          2.763110e-03       0.0018315018     1.258233e-03
100 2017-04-01          3.388035e-03       0.0027422303     9.926250e-03
101 2017-05-01          2.261570e-03       0.0009115770     1.411303e-02
102 2017-06-01          3.498703e-04       0.0027322404     6.373931e-03
103 2017-07-01          9.392107e-04       0.0027247956     2.055445e-02
104 2017-08-01          2.253561e-03       0.0013586957     2.917835e-03
105 2017-09-01          4.786863e-03       0.0031659882     2.014068e-02
106 2017-10-01          2.803075e-03       0.0000000000     2.356420e-02
107 2017-11-01         -3.771047e-04       0.0018034265     3.056581e-02
108 2017-12-01          8.595008e-04       0.0036003600     1.208662e-02
109 2018-01-01          5.016573e-03       0.0035874439     5.635903e-02
110 2018-02-01          5.211918e-03       0.0017873101    -3.636019e-02
111 2018-03-01          3.877132e-03       0.0035682426    -2.741576e-02
112 2018-04-01          3.996260e-03       0.0017777778     5.168510e-03
113 2018-05-01          4.590955e-03       0.0022182786     2.430905e-02
114 2018-06-01          1.869017e-03       0.0030987162     5.754926e-03
115 2018-07-01          9.062230e-04       0.0017652251     3.704661e-02
116 2018-08-01          1.606237e-03       0.0035242291     3.192012e-02
117 2018-09-01          2.685376e-03       0.0030728709     5.948180e-03
118 2018-10-01          4.111578e-03       0.0021881838    -6.910418e-02
119 2018-11-01         -2.017318e-03       0.0043668122     1.854904e-02
120 2018-12-01         -1.690143e-03       0.0047826087    -8.793628e-02
121 2019-01-01          1.564804e-03       0.0012981393     8.006564e-02
122 2019-02-01          2.224950e-03       0.0030250648     3.241594e-02
123 2019-03-01          4.338599e-03       0.0043084877     1.807872e-02
124 2019-04-01          8.048771e-03       0.0008580009     4.085267e-02
125 2019-05-01          5.038550e-03       0.0021431633    -6.377119e-02
126 2019-06-01          2.842587e-04       0.0038494440     6.959247e-02
127 2019-07-01          2.657248e-04       0.0034086067     1.511945e-02
128 2019-08-01          8.670659e-04       0.0029723992    -1.674358e-02
129 2019-09-01          3.089241e-03       0.0025402202     1.947915e-02
130 2019-10-01          5.225981e-03       0.0029560811     2.210466e-02
131 2019-11-01         -1.447771e-03       0.0037894737     3.619830e-02
132 2019-12-01         -1.991740e-03      -0.0004194631     2.903357e-02
133 2020-01-01          2.773457e-03       0.0033571129    -4.040608e-04
134 2020-02-01          3.921856e-03       0.0041823505    -7.916574e-02
135 2020-03-01         -1.519613e-03       0.0058309038    -1.246427e-01
136 2020-04-01         -3.948977e-03       0.0409937888     1.269836e-01
137 2020-05-01          5.459615e-04      -0.0059665871     4.764532e-02
138 2020-06-01          4.002754e-03      -0.0080032013     1.776075e-02
139 2020-07-01          5.259798e-03      -0.0040338846     5.889230e-02
140 2020-08-01          3.069700e-03       0.0052652896     6.979666e-02
141 2020-09-01         -7.596503e-05      -0.0004029009    -3.739838e-02
142 2020-10-01          1.642416e-03       0.0016122531    -2.493329e-02
143 2020-11-01         -3.611725e-06       0.0032193159     1.087768e-01
144 2020-12-01         -1.018510e-03       0.0092258323     3.706605e-02
145 2021-01-01          2.331946e-03       0.0003974563    -1.019065e-02
146 2021-02-01          5.280661e-03       0.0031783870     2.780552e-02
147 2021-03-01          6.899843e-03       0.0035643564     4.540528e-02
148 2021-04-01          1.026993e-02       0.0067087609     5.291030e-02
149 2021-05-01          8.063293e-03       0.0066640533     6.566029e-03
150 2021-06-01          8.642619e-03       0.0050623053     2.247274e-02
151 2021-07-01          5.550487e-03       0.0058117009     2.441247e-02
152 2021-08-01          1.828450e-03       0.0061633282     2.975980e-02
153 2021-09-01          2.272782e-03       0.0068912711    -4.657523e-02
154 2021-10-01          8.053516e-03       0.0060836502     7.016348e-02
155 2021-11-01          5.415870e-03       0.0041572184    -8.034782e-03
156 2021-12-01          3.783230e-03       0.0071509221     4.628837e-02
157 2022-01-01          8.790890e-03       0.0052316891    -5.274129e-02
158 2022-02-01          8.212116e-03       0.0026022305    -2.951712e-02
159 2022-03-01          1.302971e-02       0.0051909529     3.755569e-02
160 2022-04-01          6.762116e-03       0.0059018812    -8.776903e-02
161 2022-05-01          8.139478e-03       0.0044004400     2.257255e-03
162 2022-06-01          1.243682e-02       0.0051113545    -8.246930e-02
163 2022-07-01          1.451374e-03       0.0047221213     9.208753e-02
164 2022-08-01          1.974830e-04       0.0032537961    -4.080203e-02
165 2022-09-01          3.442533e-03       0.0039639640    -9.241634e-02
166 2022-10-01          6.997912e-03       0.0050251256     8.127562e-02
167 2022-11-01         -4.349210e-03       0.0046428571     5.559131e-02
168 2022-12-01         -4.178286e-03       0.0035549236    -5.757565e-02
169 2023-01-01          9.148154e-03       0.0028338647     6.288713e-02
170 2023-02-01          5.206676e-03       0.0038855528    -2.514253e-02
171 2023-03-01          4.966628e-03       0.0056298381     3.712489e-02
172 2023-04-01          4.589745e-03       0.0034989503     1.597508e-02
173 2023-05-01          4.152868e-03       0.0038354254     4.616008e-03
174 2023-06-01          2.852948e-03       0.0038207711     6.481415e-02
175 2023-07-01          1.285260e-03       0.0044982699     3.273340e-02
176 2023-08-01          4.214058e-03       0.0020668274    -1.625211e-02
177 2023-09-01          3.853063e-03       0.0030938467    -4.739330e-02
178 2023-10-01          6.626136e-04       0.0037697053    -2.170851e-02
179 2023-11-01         -4.299559e-03       0.0044383749     9.134376e-02
180 2023-12-01         -1.124735e-03       0.0030591434     4.566261e-02
181 2024-01-01          6.507492e-03       0.0044052863     1.592633e-02
182 2024-02-01          3.920098e-03       0.0020242915     5.218702e-02
183 2024-03-01          8.693170e-03       0.0030303030     3.272381e-02
184 2024-04-01          5.562880e-03       0.0013427325    -4.031963e-02
185 2024-05-01          6.525071e-04       0.0040227958     5.057962e-02
186 2024-06-01         -1.812827e-03       0.0040066778     3.528476e-02
187 2024-07-01         -1.462558e-03       0.0029930163     1.210904e-02
188 2024-08-01          8.043845e-04       0.0033156499     2.336561e-02
189 2024-09-01          2.468195e-03       0.0003635162     1.308794e-03
190 2024-10-01          8.885166e-06       0.0000000000     0.000000e+00
    intl_equity_growth  bond_yield short_term_yield
2        -0.0027563603 0.028700000         0.009800
3         0.0000000000 0.028195455         0.009300
4         0.0932066341 0.029271429         0.009300
5         0.1305881555 0.032930000         0.009300
6        -0.0182189106 0.037218182         0.011800
7         0.1057415577 0.035622727         0.010200
8         0.0449657820 0.035871429         0.011200
9         0.0393908649 0.034019048         0.009600
10       -0.0276972044 0.033876190         0.009500
11        0.0410806387 0.034026316         0.008000
12        0.0078699853 0.035900000         0.008700
13       -0.0543831169 0.037331579         0.009300
14        0.0074184190 0.036910526         0.008600
15        0.0629563694 0.037273913         0.009600
16       -0.0277329966 0.038468182         0.010600
17       -0.1152707091 0.034200000         0.008300
18       -0.0181323144 0.032040909         0.007200
19        0.1166246918 0.030114286         0.006200
20       -0.0358355373 0.026986364         0.005200
21        0.0965703704 0.026476190         0.004800
22        0.0405545600 0.025400000         0.003800
23       -0.0489958695 0.027630000         0.004500
24        0.0843783045 0.032909091         0.006200
25        0.0215750859 0.033940000         0.006100
26        0.0365564878 0.035763158         0.007700
27       -0.0250226275 0.034143478         0.007000
28        0.0619142209 0.034550000         0.007300
29       -0.0270048444 0.031685714         0.005600
30       -0.0121940215 0.030022727         0.004100
31       -0.0238947297 0.030030000         0.004100
32       -0.0858253138 0.023030435         0.002300
33       -0.1132985850 0.019752381         0.002100
34        0.0975759127 0.021520000         0.002800
35       -0.0208646814 0.020135000         0.002500
36       -0.0212485695 0.019780952         0.002600
37        0.0561526420 0.019665000         0.002400
38        0.0488427579 0.019675000         0.002800
39        0.0032742955 0.021727273         0.003400
40       -0.0238028780 0.020528571         0.002900
41       -0.1116800394 0.018031818         0.002900
42        0.0698078637 0.016223810         0.002900
43        0.0025319737 0.015266667         0.002500
44        0.0328602297 0.016782609         0.002700
45        0.0263521397 0.017231579         0.002600
46        0.0106447848 0.017461905         0.002800
47        0.0270815377 0.016540000         0.002700
48        0.0423541062 0.017190000         0.002600
49        0.0383184793 0.019147619         0.002700
50       -0.0114795473 0.019842105         0.002700
51        0.0118795494 0.019575000         0.002600
52        0.0521540280 0.017590909         0.002300
53       -0.0297390785 0.019281818         0.002500
54       -0.0276929853 0.023000000         0.003300
55        0.0519652940 0.025822727         0.003400
56       -0.0160206680 0.027372727         0.003600
57        0.0784990531 0.028095000         0.004000
58        0.0320887039 0.026159091         0.003400
59        0.0066086237 0.027184211         0.003000
60        0.0189550163 0.029019048         0.003400
61       -0.0520636116 0.028580952         0.003900
62        0.0594788283 0.027094737         0.003300
63       -0.0036551343 0.027233333         0.004000
64        0.0157506315 0.027052381         0.004200
65        0.0176519350 0.025590476         0.003900
66        0.0104266160 0.025985714         0.004500
67       -0.0237141529 0.025422727         0.005100
68        0.0026456568 0.024200000         0.004700
69       -0.0415534921 0.025342857         0.005700
70       -0.0035247457 0.023040909         0.004500
71        0.0000000000 0.023255556         0.005300
72       -0.0377257679 0.022072727         0.006400
73        0.0071268674 0.018815000         0.005500
74        0.0615977808 0.019752632         0.006200
75       -0.0121582445 0.020427273         0.006400
76        0.0386638673 0.019350000         0.005400
77       -0.0004837278 0.021975000         0.006100
78       -0.0290986129 0.023636364         0.006900
79        0.0146304910 0.023245455         0.006700
80       -0.0723351369 0.021671429         0.007000
81       -0.0408413064 0.021728571         0.007100
82        0.0673387377 0.020700000         0.006400
83       -0.0076224996 0.022631579         0.008800
84       -0.0213757534 0.022427273         0.009800
85       -0.0552804058 0.020852632         0.009000
86       -0.0308463805 0.017795000         0.007300
87        0.0719591601 0.018890909         0.008800
88        0.0231321906 0.018052381         0.007700
89       -0.0029965257 0.018061905         0.008200
90       -0.0204044960 0.016440909         0.007300
91        0.0415691014 0.015040000         0.006700
92        0.0040749233 0.015565217         0.007400
93        0.0164811732 0.016304762         0.007700
94       -0.0240603895 0.017645000         0.008400
95       -0.0150639481 0.021420000         0.009800
96        0.0245096659 0.024919048         0.012000
97        0.0366734810 0.024325000         0.012100
98        0.0105591441 0.024189474         0.012000
99        0.0305724546 0.024817391         0.013100
100       0.0221393407 0.022973684         0.012400
101       0.0341039995 0.023036364         0.013000
102       0.0063826969 0.021868182         0.013400
103       0.0288002441 0.023180000         0.013700
104       0.0002355370 0.022091304         0.013400
105       0.0251529176 0.022020000         0.013800
106       0.0177382397 0.023600000         0.015500
107       0.0086016891 0.023533333         0.017000
108       0.0164986049 0.024025000         0.018400
109       0.0474803094 0.025838095         0.020300
110      -0.0510752130 0.028589474         0.021800
111      -0.0039756430 0.028423810         0.022800
112       0.0126553437 0.028690476         0.023800
113      -0.0142809509 0.029777273         0.025100
114      -0.0166577286 0.029123810         0.025300
115       0.0228438463 0.028890476         0.026100
116      -0.0173217108 0.028891304         0.026400
117       0.0071175962 0.030042105         0.027700
118      -0.0859734382 0.031522727         0.028600
119       0.0050569626 0.031170000         0.028600
120      -0.0566730024 0.028326316         0.026800
121       0.0746636485 0.027138095         0.025400
122       0.0233239092 0.026763158         0.025000
123       0.0060213196 0.025709524         0.024100
124       0.0283818130 0.025323810         0.023400
125      -0.0521062469 0.023950000         0.022100
126       0.0585859900 0.020740000         0.018100
127      -0.0203803513 0.020590909         0.018400
128      -0.0188430751 0.016263636         0.015700
129       0.0315617900 0.016995000         0.016500
130       0.0321311383 0.017068182         0.015500
131       0.0134451076 0.018121053         0.016100
132       0.0356535085 0.018628571         0.016100
133      -0.0299593626 0.017576190         0.015200
134      -0.0765107291 0.015042105         0.013300
135      -0.1514575449 0.008700000         0.004500
136       0.0701857597 0.006576190         0.002200
137       0.0557741293 0.006740000         0.001700
138       0.0349218074 0.007286364         0.001900
139       0.0262962378 0.006567810         0.001500
140       0.0517465457 0.006567810         0.001400
141      -0.0178743700 0.006795238         0.001300
142      -0.0354529501 0.007871429         0.001500
143       0.1429678896 0.008700000         0.001700
144       0.0563980248 0.009336364         0.001400
145      -0.0072023066 0.010810526         0.001300
146       0.0243242405 0.012578947         0.001300
147       0.0276861430 0.016108696         0.001500
148       0.0305424325 0.016350000         0.001600
149       0.0357635444 0.016210000         0.001600
150      -0.0093298361 0.015190909         0.002000
151       0.0050464990 0.013185714         0.002200
152       0.0131330842 0.012831818         0.002200
153      -0.0337850783 0.013747619         0.002400
154       0.0322840719 0.015825000         0.003900
155      -0.0464303355 0.015595000         0.005100
156       0.0433695041 0.014650000         0.006800
157      -0.0385837764 0.017640000         0.009800
158      -0.0264811807 0.019342105         0.014400
159       0.0067595749 0.021278261         0.019100
160      -0.0678736598 0.027475000         0.025400
161       0.0165294247 0.028980952         0.026200
162      -0.0918798951 0.031433333         0.030000
163       0.0529403453 0.028960000         0.030400
164      -0.0581936292 0.028978261         0.032500
165      -0.0986197197 0.035190476         0.038600
166       0.0607805484 0.039835000         0.043800
167       0.1254881074 0.038910000         0.045000
168      -0.0218123685 0.036161905         0.042900
169       0.0903029483 0.035315000         0.042100
170      -0.0347470642 0.037468421         0.045300
171       0.0264208375 0.036630435         0.043000
172       0.0263440623 0.034600000         0.040200
173      -0.0373159637 0.035736364         0.041300
174       0.0444176712 0.037480952         0.046400
175       0.0313978485 0.038995000         0.048300
176      -0.0394702131 0.041678261         0.049000
177      -0.0378259123 0.043790000         0.049132
178      -0.0338518445 0.045068429         0.049132
179       0.0880685425 0.045028571         0.048800
180       0.0558316971 0.040200000         0.044600
181      -0.0108564202 0.040580952         0.043200
182       0.0274389392 0.042075000         0.045400
183       0.0365792704 0.042085000         0.045900
184      -0.0340839853 0.045068429         0.048700
185       0.0466346676 0.044822727         0.048600
186      -0.0164860275 0.043052632         0.047400
187       0.0301503561 0.042486364         0.045000
188       0.0031978042 0.038709091         0.039700
189       0.0000000000 0.037235000         0.036200
190      -0.0163210017 0.040954545         0.039700</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the percentages data exists and starting salary is $50,000</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>starting_salary <span class="ot">&lt;-</span> <span class="dv">50000</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>n_months <span class="ot">&lt;-</span> <span class="fu">nrow</span>(percentages)  <span class="co"># Total number of months</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector to store the salary for each month</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>salary <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_months)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>salary[<span class="dv">1</span>] <span class="ot">&lt;-</span> starting_salary</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate salary growth over the months based on wage_growth_growth</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_months) {</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  salary[i] <span class="ot">&lt;-</span> salary[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> percentages<span class="sc">$</span>wage_growth_growth[i <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Employee contribution percentages based on salary brackets</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>employee_contribution <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_months)</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_months) {</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (salary[i] <span class="sc">&lt;=</span> <span class="dv">45000</span>) {</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>    employee_contribution[i] <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (salary[i] <span class="sc">&lt;=</span> <span class="dv">55000</span>) {</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    employee_contribution[i] <span class="ot">&lt;-</span> <span class="fl">0.035</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (salary[i] <span class="sc">&lt;=</span> <span class="dv">75000</span>) {</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>    employee_contribution[i] <span class="ot">&lt;-</span> <span class="fl">0.045</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (salary[i] <span class="sc">&lt;=</span> <span class="dv">100000</span>) {</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>    employee_contribution[i] <span class="ot">&lt;-</span> <span class="fl">0.0575</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>    employee_contribution[i] <span class="ot">&lt;-</span> <span class="fl">0.06</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Employer contributions: 8% for the first 7 years, 10% thereafter</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>employer_contribution <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_months)</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>years_of_service <span class="ot">&lt;-</span> <span class="fu">floor</span>((<span class="dv">1</span><span class="sc">:</span>n_months) <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># Convert months to years</span></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_months) {</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (years_of_service[i] <span class="sc">&lt;=</span> <span class="dv">7</span>) {</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>    employer_contribution[i] <span class="ot">&lt;-</span> <span class="fl">0.08</span></span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>    employer_contribution[i] <span class="ot">&lt;-</span> <span class="fl">0.10</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate monthly contributions for ORP (employee + employer)</span></span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>monthly_contribution_orp <span class="ot">&lt;-</span> salary <span class="sc">*</span> (employee_contribution <span class="sc">+</span> employer_contribution)</span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate compounded ORP balance</span></span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a>orp_balance <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_months)</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a>orp_balance[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># Assume no balance at the start</span></span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_months) {</span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Growth is applied according to equity, international equity, and bond growth</span></span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a>  equity_growth <span class="ot">&lt;-</span> percentages<span class="sc">$</span>us_equity_growth[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> <span class="fl">0.47</span> <span class="sc">+</span> percentages<span class="sc">$</span>intl_equity_growth[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> <span class="fl">0.32</span> <span class="sc">+</span> percentages<span class="sc">$</span>bond_yield[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> <span class="fl">0.21</span></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a>  orp_balance[i] <span class="ot">&lt;-</span> orp_balance[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> equity_growth) <span class="sc">+</span> monthly_contribution_orp[i]</span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Final ORP balance at retirement (end of the last month)</span></span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a>final_orp_balance <span class="ot">&lt;-</span> orp_balance[n_months]</span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate 4% annual withdrawal rate for the first month of retirement</span></span>
<span id="cb79-59"><a href="#cb79-59" aria-hidden="true" tabindex="-1"></a>orp_monthly_withdrawal <span class="ot">&lt;-</span> final_orp_balance <span class="sc">*</span> <span class="fl">0.04</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb79-60"><a href="#cb79-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-61"><a href="#cb79-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate TRS pension benefit: Final Average Salary (FAS) based on last 3 years</span></span>
<span id="cb79-62"><a href="#cb79-62" aria-hidden="true" tabindex="-1"></a>fas <span class="ot">&lt;-</span> <span class="fu">mean</span>(salary[(n_months <span class="sc">-</span> <span class="dv">35</span>)<span class="sc">:</span>n_months])  <span class="co"># Last 36 months (3 years)</span></span>
<span id="cb79-63"><a href="#cb79-63" aria-hidden="true" tabindex="-1"></a>years_served <span class="ot">&lt;-</span> n_months <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># Years of service</span></span>
<span id="cb79-64"><a href="#cb79-64" aria-hidden="true" tabindex="-1"></a>trs_benefit <span class="ot">&lt;-</span> fas <span class="sc">*</span> <span class="fl">0.025</span> <span class="sc">*</span> years_served  <span class="co"># Assuming 2.5% per year</span></span>
<span id="cb79-65"><a href="#cb79-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-66"><a href="#cb79-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly TRS benefit</span></span>
<span id="cb79-67"><a href="#cb79-67" aria-hidden="true" tabindex="-1"></a>trs_monthly_benefit <span class="ot">&lt;-</span> trs_benefit <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb79-68"><a href="#cb79-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-69"><a href="#cb79-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Output results</span></span>
<span id="cb79-70"><a href="#cb79-70" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"TRS Monthly Benefit at Retirement (First Month): $"</span>, <span class="fu">round</span>(trs_monthly_benefit, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TRS Monthly Benefit at Retirement (First Month): $ 2531.95 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ORP Monthly Withdrawal (First Month): $"</span>, <span class="fu">round</span>(orp_monthly_withdrawal, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP Monthly Withdrawal (First Month): $ 17529.87 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="fixed-rate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="fixed-rate-analysis">Fixed-Rate Analysis</h2>
<p>To modify the simulation and project an employee’s pension benefit (TRS) or withdrawal amount (ORP) from retirement until death, we need to consider several key factors:</p>
<p>Estimated Death Age: We’ll assume a reasonable life expectancy for the employee. Cost-of-Living Adjustments (COLA) for TRS: We’ll apply annual inflation adjustments to the TRS benefit, which increase by 50% of the CPI each year, capped at 3%. ORP Market Returns: We’ll assume long-run average returns for the ORP portfolio, based on historical equity, bond, and international equity returns. Projecting Retirement Income: We will simulate the monthly income over time, considering the employee’s longevity and both TRS and ORP scenarios.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>death_age <span class="ot">&lt;-</span> <span class="dv">85</span>  <span class="co"># Assumed age of death</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>start_age <span class="ot">&lt;-</span> <span class="dv">50</span>  <span class="co"># Starting age of the employee</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>current_age <span class="ot">&lt;-</span> start_age <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># Employee starts at 51 after the first year</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to simulate (from retirement to death)</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>years_of_retirement <span class="ot">&lt;-</span> death_age <span class="sc">-</span> (start_age <span class="sc">+</span> (n_months <span class="sc">/</span> <span class="dv">12</span>))  <span class="co"># Years from retirement to death</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>total_months_in_retirement <span class="ot">&lt;-</span> years_of_retirement <span class="sc">*</span> <span class="dv">12</span>  <span class="co"># Total months in retirement</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize variables</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>monthly_income_trs <span class="ot">&lt;-</span> <span class="fu">numeric</span>(total_months_in_retirement)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>monthly_income_orp <span class="ot">&lt;-</span> <span class="fu">numeric</span>(total_months_in_retirement)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>orp_balance_retirement <span class="ot">&lt;-</span> final_orp_balance  <span class="co"># Starting ORP balance at retirement</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>trs_benefit_retirement <span class="ot">&lt;-</span> trs_monthly_benefit  <span class="co"># Starting TRS benefit at retirement</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a><span class="co"># TRS: Apply COLA (cost of living adjustment) each year, capped at 3%</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_months_in_retirement) {</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">12</span> <span class="sc">==</span> <span class="dv">0</span>) {  <span class="co"># At the start of each year</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    inflation_rate <span class="ot">&lt;-</span> percentages<span class="sc">$</span>inflation_rate_growth[i <span class="sc">%%</span> n_months]  <span class="co"># Using inflation data from percentages</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>    inflation_adjustment <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fl">0.03</span>, inflation_rate <span class="sc">*</span> <span class="fl">0.5</span>)  <span class="co"># Apply COLA, capped at 3%</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>    trs_benefit_retirement <span class="ot">&lt;-</span> trs_benefit_retirement <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> inflation_adjustment)</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>  monthly_income_trs[i] <span class="ot">&lt;-</span> trs_benefit_retirement  <span class="co"># Monthly TRS income</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ORP: Apply 4% annual withdrawal rate and simulate market returns</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_months_in_retirement) {</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply monthly growth from historical returns (average returns assumed for simplicity)</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>  average_market_growth <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(percentages<span class="sc">$</span>us_equity_growth, percentages<span class="sc">$</span>intl_equity_growth, percentages<span class="sc">$</span>bond_yield), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>  orp_balance_retirement <span class="ot">&lt;-</span> orp_balance_retirement <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> average_market_growth <span class="sc">/</span> <span class="dv">12</span>)  <span class="co"># Monthly compounded growth</span></span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>  orp_monthly_withdrawal <span class="ot">&lt;-</span> orp_balance_retirement <span class="sc">*</span> <span class="fl">0.04</span> <span class="sc">/</span> <span class="dv">12</span>  <span class="co"># 4% annual withdrawal rate</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>  orp_balance_retirement <span class="ot">&lt;-</span> orp_balance_retirement <span class="sc">-</span> orp_monthly_withdrawal  <span class="co"># Subtract withdrawal</span></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>  monthly_income_orp[i] <span class="ot">&lt;-</span> orp_monthly_withdrawal  <span class="co"># Monthly ORP income</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Stop the ORP withdrawals if the balance runs out</span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (orp_balance_retirement <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>    monthly_income_orp[i] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the maximum and minimum income gap between TRS and ORP</span></span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a>income_gap <span class="ot">&lt;-</span> monthly_income_trs <span class="sc">-</span> monthly_income_orp</span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a>max_gap <span class="ot">&lt;-</span> <span class="fu">max</span>(income_gap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a>min_gap <span class="ot">&lt;-</span> <span class="fu">min</span>(income_gap, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average monthly income for both TRS and ORP</span></span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>avg_income_trs <span class="ot">&lt;-</span> <span class="fu">mean</span>(monthly_income_trs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a>avg_income_orp <span class="ot">&lt;-</span> <span class="fu">mean</span>(monthly_income_orp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine if ORP funds run out before death or if there are funds left for heirs</span></span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (orp_balance_retirement <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>  run_out_of_funds <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a>  remaining_funds <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a>  run_out_of_funds <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a>  remaining_funds <span class="ot">&lt;-</span> orp_balance_retirement</span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-60"><a href="#cb83-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-61"><a href="#cb83-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Output results</span></span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average Monthly Income - TRS: $"</span>, <span class="fu">round</span>(avg_income_trs, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average Monthly Income - TRS: $ 2573.32 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Average Monthly Income - ORP: $"</span>, <span class="fu">round</span>(avg_income_orp, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Average Monthly Income - ORP: $ 13956.3 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Maximum Monthly Income Gap (TRS vs ORP): $"</span>, <span class="fu">round</span>(max_gap, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum Monthly Income Gap (TRS vs ORP): $ -8261.52 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Minimum Monthly Income Gap (TRS vs ORP): $"</span>, <span class="fu">round</span>(min_gap, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum Monthly Income Gap (TRS vs ORP): $ -15020.06 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"TRS Monthly Benefit at Retirement (First Month): $"</span>, <span class="fu">round</span>(trs_monthly_benefit, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TRS Monthly Benefit at Retirement (First Month): $ 2531.95 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"ORP Monthly Withdrawal at Retirement (First Month): $"</span>, <span class="fu">round</span>(orp_monthly_withdrawal, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP Monthly Withdrawal at Retirement (First Month): $ 10886.85 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (run_out_of_funds) {</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ORP funds run out before death. There are no funds left for heirs.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"ORP funds last until death. Remaining funds for heirs: $"</span>, <span class="fu">round</span>(remaining_funds, <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP funds last until death. Remaining funds for heirs: $ 3255167 </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/<GITHUB_NAME>\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>