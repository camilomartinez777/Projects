<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Juan Camilo Martinez Benavides">

<title>Mini-Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Juan Camilo Martinez Benavides </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Selecting a retirement plan is one of the most critical financial decisions for new CUNY faculty, as it has permanent implications for their long-term financial security. Once chosen, the plan cannot be changed, making it essential to consider the potential risks and rewards. This project evaluates the Teachers Retirement System (TRS) and the Optional Retirement Plan (ORP) using historical economic data and Monte Carlo simulations. By modeling contributions, investment returns, and inflation-adjusted benefits, we aim to provide a personalized, data-driven recommendation tailored to individual financial goals and risk tolerance.</p>
</section>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<p>The primary goal of this project is to equip new CUNY faculty with an evidence-based recommendation for selecting the optimal retirement plan (TRS or ORP). This involves analyzing historical economic and financial data to assess how each plan performs under different economic conditions. We will utilize the following datasets:</p>
<ul>
<li>Rate of Inflation: Inflation erodes the purchasing power of retirement benefits. For TRS, it determines the annual adjustment in benefits, while for ORP, it impacts the real value of savings and withdrawals.</li>
<li>Rate of Wage Growth: Wage growth directly influences contributions to both plans. For TRS, it affects the final average salary (FAS), which determines retirement payouts. For ORP, higher wages lead to larger investment contributions.</li>
<li>US Equity Market Returns: Equity market performance is crucial for ORP participants, as their investments grow with market returns. US equities represent a significant portion of most retirement portfolios.</li>
<li>International Equity Market Returns: Diversification through international equities reduces risk and enhances returns for ORP participants. It provides a broader perspective on investment performance beyond the US market.</li>
<li>Bond Returns: Bonds are a critical component of retirement portfolios, especially for ORP participants as they approach retirement. Bonds provide stability and reduce volatility in investment returns.</li>
<li>Short-Term Debt Returns: Short-term debt, such as Treasury yields, represents a safe investment option with lower risk. It is particularly relevant for retirees seeking liquidity and capital preservation.</li>
</ul>
<p>By combining insights from these datasets, we will simulate potential retirement outcomes for each plan, identify risks such as running out of funds, and quantify the financial benefits of each option. This comprehensive approach ensures that our recommendation aligns with the diverse financial priorities of faculty members.</p>
<section id="libraries" class="level3">
<h3 class="anchored" data-anchor-id="libraries">Libraries</h3>
<p>The following are the libraries we would use throughtout the project.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)       <span class="co"># API requests</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)       <span class="co"># Data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)     <span class="co"># Visualization</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)         <span class="co"># Time-series data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)          <span class="co"># Interactive tables</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)  <span class="co"># Correlation plots</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)   <span class="co"># Date/time handling</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)          <span class="co"># Publication-quality tables</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)      <span class="co"># Interactive plots</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)       <span class="co"># Data reshaping</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-collection" class="level2">
<h2 class="anchored" data-anchor-id="data-collection">Data Collection</h2>
<p>For this project, we will use data from two economic and financial data sources:</p>
<ol type="1">
<li><strong>AlphaVantage</strong>: A commercial stock market data provider.</li>
<li><strong>FRED</strong>: The Federal Reserve Economic Data repository maintained by the Federal Reserve Bank of St.&nbsp;Louis.</li>
</ol>
<p>FRED is free to access, but AlphaVantage is a commercial service requiring a subscription. For this mini-project, the free tier of AlphaVantage will suffice.</p>
<section id="links-to-resources" class="level3">
<h3 class="anchored" data-anchor-id="links-to-resources">Links to Resources</h3>
<ul>
<li><a href="https://www.alphavantage.co">AlphaVantage</a></li>
<li><a href="https://fred.stlouisfed.org">FRED (Federal Reserve Economic Data)</a></li>
</ul>
</section>
</section>
<section id="data-collection-1" class="level2">
<h2 class="anchored" data-anchor-id="data-collection-1">DATA COLLECTION</h2>
<p>We would proceed to collect the data from the sources mentioned above. and we would do it on a monthly basis for the last 15 years.</p>
<p>To do so, we would use their APIs:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for the FRED API</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fred_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the base URL for the AlphaVantage API</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>alphavantage_url <span class="ot">&lt;-</span> <span class="st">"https://www.alphavantage.co/query"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read FRED API key from a file</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>fred_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"fred_key.txt"</span>) <span class="co"># Ensure this file contains only your FRED API key</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Read AlphaVantage API key from a file</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>alphavantage_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"alphavantage_key.txt"</span>) <span class="co"># Ensure this file contains only your AlphaVantage API key</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Montly basis for the last 15 years</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>Time_Montly <span class="ot">=</span><span class="fu">as.Date</span>(<span class="st">"2009-01-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fetching-data" class="level2">
<h2 class="anchored" data-anchor-id="fetching-data">Fetching Data</h2>
<p>We already have the links to the resources and the API keys, now we can proceed to fetch the data.</p>
<ul>
<li><ol type="1">
<li>Fetching Rate of Inflation (CPI for NYC Metro Area) from FRED</li>
</ol></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Inflation Data from FRED (CPI for NYC Metro Area)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>inflation_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"CUUR0400SA0"</span>,  <span class="co"># CPI for All Urban Consumers: NYC Metro Area</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>inflation_resp <span class="ot">&lt;-</span> inflation_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(inflation_resp)<span class="sc">$</span>observations</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(inflation_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date)),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">inflation_rate =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(inflation_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the data for the last 15 years</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> inflation_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><ol start="2" type="1">
<li>Fetching Rate of Wage Growth from FRED, We’ll use the AHETPI series to measure wage growth.</li>
</ol></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Wage Growth Data from FRED</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>wage_growth_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"AHETPI"</span>, <span class="co"># Average Hourly Earnings of Production and Nonsupervisory Employees</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>wage_growth_resp <span class="ot">&lt;-</span> wage_growth_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>wage_growth_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(wage_growth_resp)<span class="sc">$</span>observations</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to a DataFrame</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(wage_growth_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date)), <span class="co"># Parse date</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">wage_growth =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(wage_growth_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value)) <span class="co"># Convert to numeric</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the last 15–20 years</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> wage_growth_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><ol start="3" type="1">
<li>Fetching US Equity Market Returns from AlphaVantage</li>
</ol></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch US Equity Market Data from AlphaVantage</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>us_equity_req <span class="ot">&lt;-</span> <span class="fu">request</span>(alphavantage_url) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"SPY"</span>, <span class="co"># S&amp;P 500 ETF</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> alphavantage_key</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>us_equity_resp <span class="ot">&lt;-</span> us_equity_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>us_equity_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(us_equity_resp)<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(us_equity_data)), <span class="co"># Extract dates</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">us_equity_close =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(us_equity_data, <span class="cf">function</span>(x) x<span class="sc">$</span><span class="st">`</span><span class="at">5. adjusted close</span><span class="st">`</span>)) <span class="co"># Extract adjusted close prices</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize dates to the first of each month</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>us_equity_df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(us_equity_df<span class="sc">$</span>date, <span class="st">"%Y-%m-01"</span>))</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the past 15 years</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> us_equity_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><ol start="4" type="1">
<li>Fetching International Equity Market Returns from AlphaVantage</li>
</ol></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch International Equity Market Data from AlphaVantage</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>intl_req <span class="ot">&lt;-</span> <span class="fu">request</span>(alphavantage_url) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_MONTHLY_ADJUSTED"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"VEA"</span>, <span class="co"># Vanguard FTSE Developed Markets ETF</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">apikey =</span> alphavantage_key</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>intl_resp <span class="ot">&lt;-</span> intl_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>intl_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(intl_resp)<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the fetched data into a data frame</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(intl_data)),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">intl_equity_close =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(intl_data, <span class="cf">function</span>(x) x<span class="sc">$</span><span class="st">`</span><span class="at">5. adjusted close</span><span class="st">`</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize dates to the first of each month</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>intl_equity_df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(intl_equity_df<span class="sc">$</span>date, <span class="st">"%Y-%m-01"</span>))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the past 15 years</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> intl_equity_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><ol start="5" type="1">
<li>Fetching Bond Returns from AlphaVantage</li>
</ol></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Bond Yield Data (Daily)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>bond_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"DGS10"</span>, <span class="co"># 10-Year Treasury Yield</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>bond_resp <span class="ot">&lt;-</span> bond_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>bond_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(bond_resp)<span class="sc">$</span>observations</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(bond_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date)),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">bond_yield =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(bond_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Downsample to Monthly Averages</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%Y-%m"</span>)) <span class="sc">|&gt;</span><span class="co"># Extract year-month for grouping</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_yield =</span> <span class="fu">mean</span>(bond_yield, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co"># Average yield for the month</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(month, <span class="st">"-01"</span>))) <span class="sc">|&gt;</span><span class="co"># Convert back to Date</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, bond_yield)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the last 15 years</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> bond_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li><ol start="6" type="1">
<li>Fetching Short-Term Debt Returns from AlphaVantage: for this dataset, we need to downsample the daily data to monthly averages to align with the other datasets.</li>
</ol></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch Short-Term Debt Data (2-Year Treasury Yield) - Attempt Monthly Query</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>short_term_req <span class="ot">&lt;-</span> <span class="fu">request</span>(fred_url) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">req_url_query</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">series_id =</span> <span class="st">"DGS2"</span>, <span class="co"># 2-Year Treasury Yield</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">frequency =</span> <span class="st">"m"</span>, <span class="co"># Request monthly data directly</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">api_key =</span> fred_key,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_type =</span> <span class="st">"json"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>short_term_resp <span class="ot">&lt;-</span> short_term_req <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>short_term_data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(short_term_resp)<span class="sc">$</span>observations</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert JSON to DataFrame</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>short_term_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">sapply</span>(short_term_data, <span class="cf">function</span>(x) x<span class="sc">$</span>date), <span class="at">format =</span> <span class="st">"%Y-%m-%d"</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">short_term_yield =</span> <span class="fu">as.numeric</span>(<span class="fu">sapply</span>(short_term_data, <span class="cf">function</span>(x) x<span class="sc">$</span>value))</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the Last 15 Years</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>short_term_df <span class="ot">&lt;-</span> short_term_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(date <span class="sc">&gt;=</span> Time_Montly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-preprocessing-and-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing-and-cleaning">Data Preprocessing and Cleaning</h2>
<p>Now that we have collected the data, we can proceed to the next step, which is data preprocessing. We we gonna unify the data and deal with missing values by using bootstrapping.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize dates to the first of each month for all datasets</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">list</span>(inflation_df, wage_growth_df, us_equity_df, intl_equity_df, bond_df, short_term_df)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> datasets <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(\(df) {</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(df<span class="sc">$</span>date, <span class="st">"%Y-%m-01"</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    df</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Unpack datasets back</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>inflation_df <span class="ot">&lt;-</span> datasets[[<span class="dv">1</span>]]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>wage_growth_df <span class="ot">&lt;-</span> datasets[[<span class="dv">2</span>]]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>us_equity_df <span class="ot">&lt;-</span> datasets[[<span class="dv">3</span>]]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>intl_equity_df <span class="ot">&lt;-</span> datasets[[<span class="dv">4</span>]]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>bond_df <span class="ot">&lt;-</span> datasets[[<span class="dv">5</span>]]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>short_term_df <span class="ot">&lt;-</span> datasets[[<span class="dv">6</span>]]</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create master date sequence</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>date_seq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">"2009-01-01"</span>), </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"2024-10-01"</span>)), </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> <span class="st">"month"</span>))</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform left joins for all datasets</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> date_seq <span class="sc">|&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(inflation_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wage_growth_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(us_equity_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(intl_equity_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bond_df, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(short_term_df, <span class="at">by =</span> <span class="st">"date"</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle missing data</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">|&gt;</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">inflation_rate =</span> <span class="fu">replace</span>(inflation_rate,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">is.na</span>(inflation_rate),</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">sample</span>(<span class="fu">na.omit</span>(inflation_rate), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(inflation_rate)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">wage_growth =</span> <span class="fu">replace</span>(wage_growth,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">is.na</span>(wage_growth),</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">sample</span>(<span class="fu">na.omit</span>(wage_growth), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(wage_growth)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_equity_close =</span> <span class="fu">replace</span>(us_equity_close,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">is.na</span>(us_equity_close),</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">sample</span>(<span class="fu">na.omit</span>(us_equity_close), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(us_equity_close)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">intl_equity_close =</span> <span class="fu">replace</span>(intl_equity_close,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">is.na</span>(intl_equity_close),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">sample</span>(<span class="fu">na.omit</span>(intl_equity_close), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(intl_equity_close)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">bond_yield =</span> <span class="fu">replace</span>(bond_yield,</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">is.na</span>(bond_yield),</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">sample</span>(<span class="fu">na.omit</span>(bond_yield), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(bond_yield)), <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_term_yield =</span> <span class="fu">replace</span>(short_term_yield,</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">is.na</span>(short_term_yield),</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">sample</span>(<span class="fu">na.omit</span>(short_term_yield), <span class="at">size =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(short_term_yield)), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">2</span>)))</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Display dataset interactively</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(combined_data, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">scrollX =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1cd5230b4fc821ee03c7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1cd5230b4fc821ee03c7">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190"],["2009-01-01","2009-02-01","2009-03-01","2009-04-01","2009-05-01","2009-06-01","2009-07-01","2009-08-01","2009-09-01","2009-10-01","2009-11-01","2009-12-01","2010-01-01","2010-02-01","2010-03-01","2010-04-01","2010-05-01","2010-06-01","2010-07-01","2010-08-01","2010-09-01","2010-10-01","2010-11-01","2010-12-01","2011-01-01","2011-02-01","2011-03-01","2011-04-01","2011-05-01","2011-06-01","2011-07-01","2011-08-01","2011-09-01","2011-10-01","2011-11-01","2011-12-01","2012-01-01","2012-02-01","2012-03-01","2012-04-01","2012-05-01","2012-06-01","2012-07-01","2012-08-01","2012-09-01","2012-10-01","2012-11-01","2012-12-01","2013-01-01","2013-02-01","2013-03-01","2013-04-01","2013-05-01","2013-06-01","2013-07-01","2013-08-01","2013-09-01","2013-10-01","2013-11-01","2013-12-01","2014-01-01","2014-02-01","2014-03-01","2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01","2015-05-01","2015-06-01","2015-07-01","2015-08-01","2015-09-01","2015-10-01","2015-11-01","2015-12-01","2016-01-01","2016-02-01","2016-03-01","2016-04-01","2016-05-01","2016-06-01","2016-07-01","2016-08-01","2016-09-01","2016-10-01","2016-11-01","2016-12-01","2017-01-01","2017-02-01","2017-03-01","2017-04-01","2017-05-01","2017-06-01","2017-07-01","2017-08-01","2017-09-01","2017-10-01","2017-11-01","2017-12-01","2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01","2023-01-01","2023-02-01","2023-03-01","2023-04-01","2023-05-01","2023-06-01","2023-07-01","2023-08-01","2023-09-01","2023-10-01","2023-11-01","2023-12-01","2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01","2024-07-01","2024-08-01","2024-09-01","2024-10-01"],[215.92,217.1,217.36,217.91,218.57,219.86,219.48,219.88,220.29,220.45,219.73,219.31,219.99,220.18,220.81,221.2,221.42,221.15,221.33,221.52,221.38,221.71,221.67,222.08,223.15,224.43,226.56,227.84,228.52,228.07,227.8,228.22,229.15,229.2,228.77,228.12,228.98,230,232.04,232.56,233.05,232.7,231.89,233,234.08,234.97,233.21,232.03,232.76,234.6,235.51,235.49,235.98,236.23,236.34,236.59,237.15,237,236.15,236.1,236.71,237.61,239.09,239.81,241.35,241.62,241.85,241.66,241.92,241.65,240.22,239.1,238.32,239.75,241.69,242.3,244.23,244.33,245.04,244.74,244.26,244.34,243.75,243.43,244.6,244.82,245.4,246.59,247.85,248.23,248.38,248.5,249.23,249.9,249.45,249.52,250.81,252.25,252.95,253.81,254.38,254.47,254.71,255.28,256.5,257.22,257.13,257.35,258.64,259.99,260.99,262.04,263.24,263.73,263.97,264.4,265.1,266.2,265.66,265.21,265.62,266.21,267.37,269.52,270.88,270.96,271.03,271.26,272.1,273.52,273.13,272.58,273.34,274.41,274,272.91,273.06,274.15,275.6,276.44,276.42,276.88,276.88,276.59,277.24,278.7,280.62,283.51,285.79,288.26,289.86,290.39,291.05,293.4,294.99,296.1,298.7,301.16,305.08,307.14,309.64,313.5,313.95,314.01,315.09,317.3,315.92,314.6,317.48,319.13,320.71,322.19,323.52,324.45,324.86,326.23,327.49,327.71,326.3,325.93,328.05,329.34,332.2,334.05,334.29,333.66,333.17,333.44,334.26,334.56],[18.39,18.44,18.5,18.52,18.53,18.56,18.59,18.67,18.7,18.74,18.8,18.84,18.88,18.91,18.91,18.96,19.01,19.03,19.04,19.11,19.11,19.2,19.21,19.22,19.33,19.31,19.31,19.36,19.41,19.41,19.47,19.47,19.49,19.56,19.56,19.57,19.59,19.59,19.64,19.68,19.67,19.71,19.74,19.74,19.79,19.79,19.85,19.91,19.94,19.99,20,20.04,20.05,20.12,20.14,20.18,20.23,20.25,20.31,20.35,20.39,20.51,20.5,20.51,20.54,20.59,20.61,20.66,20.67,20.7,20.77,20.71,20.8,20.84,20.91,20.92,20.98,21,21.03,21.1,21.09,21.19,21.21,21.23,21.31,21.33,21.39,21.46,21.47,21.52,21.58,21.6,21.63,21.71,21.71,21.76,21.81,21.84,21.88,21.94,21.96,22.02,22.08,22.11,22.18,22.18,22.22,22.3,22.38,22.42,22.5,22.54,22.59,22.66,22.7,22.78,22.85,22.9,23,23.11,23.14,23.21,23.31,23.33,23.38,23.47,23.55,23.62,23.68,23.75,23.84,23.83,23.91,24.01,24.15,25.14,24.99,24.79,24.69,24.82,24.81,24.85,24.93,25.16,25.17,25.25,25.34,25.51,25.68,25.81,25.96,26.12,26.3,26.46,26.57,26.76,26.9,26.97,27.11,27.27,27.39,27.53,27.66,27.75,27.86,28,28.13,28.23,28.31,28.42,28.58,28.68,28.79,28.9,29.03,29.09,29.18,29.29,29.42,29.51,29.64,29.7,29.79,29.83,29.95,30.07,30.16,30.26,30.36,30.48],[61.6,54.98,59.57,65.48999999999999,69.31999999999999,69.27,74.44,77.19,79.92,78.39,83.22,84.8,81.72,84.27,89.40000000000001,90.79000000000001,83.56999999999999,79.25,84.66,80.84999999999999,88.09,91.45999999999999,91.45999999999999,97.56999999999999,99.84999999999999,103.31,103.33,106.32,105.13,103.35,101.28,95.70999999999999,89.06999999999999,98.79000000000001,98.39,99.41,104.03,108.54,112.03,111.28,104.6,108.84,110.13,112.89,115.75,113.64,114.28,115.31,121.22,122.76,127.42,129.87,132.94,131.16,137.94,133.8,138.04,144.43,148.72,152.57,147.19,153.89,155.17,156.25,159.87,163.17,160.98,167.33,165.02,168.91,173.55,173.11,167.98,177.42,174.62,176.34,178.61,175.02,178.89,167.92,163.72,177.69,178.34,175.27,166.55,166.41,177.6,178.3,181.33,181.97,188.6,188.83,188.84,185.57,192.41,196.31,199.82,207.67,207.93,210,212.96,214.32,218.72,219.36,223.78,229.05,236.05,238.91,252.37,243.2,236.53,237.75,243.53,244.93,254.01,262.11,263.67,245.45,250,228.02,246.28,254.26,258.86,269.43,252.25,269.8,273.88,269.3,274.54,280.61,290.77,299.21,299.09,275.41,241.09,271.7,284.64,289.7,306.76,328.17,315.9,308.02,341.53,354.19,350.58,360.33,376.69,396.62,399.22,408.19,418.16,430.6,410.55,439.35,435.82,456,431.95,419.2,434.94,396.77,397.66,364.87,398.47,382.21,346.89,375.08,395.93,373.13,396.6,386.63,400.98,407.39,409.27,435.79,450.06,442.74,421.76,412.61,450.29,470.86,478.35,503.32,519.79,498.83,524.0599999999999,542.55,549.12,561.95,573.76,568.64],[14.87,13.37,14.5,16.22,18.33,18,19.9,20.8,21.62,21.02,21.88,22.05,20.85,21.01,22.33,21.71,19.21,18.86,21.06,20.31,22.27,23.17,22.03,23.89,24.41,25.3,24.67,26.2,25.49,25.18,24.58,22.47,19.92,21.86,21.41,20.95,22.13,23.21,23.29,22.73,20.19,21.6,21.66,22.37,22.96,23.2,23.83,24.84,25.79,25.5,25.8,27.15,26.34,25.61,26.94,26.51,28.59,29.51,29.7,30.26,28.69,30.4,30.28,30.76,31.3,31.63,30.88,30.96,29.68,29.57,29.57,28.46,28.66,30.42,30.05,31.22,31.2,30.29,30.74,28.51,27.35,29.19,28.97,28.35,26.78,25.95,27.82,28.47,28.38,27.8,28.96,29.08,29.55,28.84,28.41,29.11,30.17,30.49,31.42,32.12,33.21,33.43,34.39,34.4,35.26,35.89,36.2,36.79,38.54,36.57,36.43,36.89,36.36,35.76,36.57,35.94,36.19,33.08,33.25,31.37,33.71,34.49,34.7,35.69,33.83,35.81,35.08,34.42,35.5,36.65,37.14,38.46,37.31,34.46,29.24,31.29,33.03,34.19,35.09,36.9,36.24,34.96,39.96,42.21,41.9,42.92,44.11,45.46,47.09,46.65,46.88,47.5,45.89,47.37,45.17,47.13,45.32,44.12,44.41,41.4,42.08,38.22,40.24,37.9,34.16,36.24,40.78,39.89,43.5,41.99,43.1,44.23,42.58,44.47,45.87,44.06,42.39,40.96,44.56,47.05,46.54,47.82,49.57,47.88,50.11,49.28,50.77,52.24,52.81,50.1],[2.52,2.87,2.82,2.93,3.29,3.72,3.56,3.59,3.4,3.39,3.4,3.59,3.73,3.69,3.73,3.85,3.42,3.2,3.01,2.7,2.65,2.54,2.76,3.29,3.39,3.58,3.41,3.46,3.17,3,3,2.3,1.98,2.15,2.01,1.98,1.97,1.97,2.17,2.05,1.8,1.62,1.53,1.68,1.72,1.75,1.65,1.72,1.91,1.98,1.96,1.76,1.93,2.3,2.58,2.74,2.81,2.62,2.72,2.9,2.86,2.71,2.72,2.71,2.56,2.6,2.54,2.42,2.53,2.3,2.33,2.21,1.88,1.98,2.04,1.94,2.2,2.36,2.32,2.17,2.17,2.07,2.26,2.24,2.09,1.78,1.89,1.81,1.81,1.64,1.5,1.56,1.63,1.76,2.14,2.49,2.43,2.42,2.48,2.3,2.3,2.19,2.32,2.21,2.2,2.36,2.35,2.4,2.58,2.86,2.84,2.87,2.98,2.91,2.89,2.89,3,3.15,3.12,2.83,2.71,2.68,2.57,2.53,2.4,2.07,2.06,1.63,1.7,1.71,1.81,1.86,1.76,1.5,0.87,0.66,0.67,0.73,0.62,0.65,0.68,0.79,0.87,0.93,1.08,1.26,1.61,1.64,1.62,1.52,1.32,1.28,1.37,1.58,1.56,1.47,1.76,1.93,2.13,2.75,2.9,3.14,2.9,2.9,3.52,3.98,3.89,3.62,3.53,3.75,3.66,3.46,3.57,3.75,3.9,4.17,4.38,4.8,4.5,4.02,4.06,4.21,4.21,4.54,4.48,4.31,4.25,3.87,3.72,4.1],[0.8100000000000001,0.98,0.93,0.93,0.93,1.18,1.02,1.12,0.96,0.95,0.8,0.87,0.93,0.86,0.96,1.06,0.83,0.72,0.62,0.52,0.48,0.38,0.45,0.62,0.61,0.77,0.7,0.73,0.5600000000000001,0.41,0.41,0.23,0.21,0.28,0.25,0.26,0.24,0.28,0.34,0.29,0.29,0.29,0.25,0.27,0.26,0.28,0.27,0.26,0.27,0.27,0.26,0.23,0.25,0.33,0.34,0.36,0.4,0.34,0.3,0.34,0.39,0.33,0.4,0.42,0.39,0.45,0.51,0.47,0.57,0.45,0.53,0.64,0.55,0.62,0.64,0.54,0.61,0.6899999999999999,0.67,0.7,0.71,0.64,0.88,0.98,0.9,0.73,0.88,0.77,0.82,0.73,0.67,0.74,0.77,0.84,0.98,1.2,1.21,1.2,1.31,1.24,1.3,1.34,1.37,1.34,1.38,1.55,1.7,1.84,2.03,2.18,2.28,2.38,2.51,2.53,2.61,2.64,2.77,2.86,2.86,2.68,2.54,2.5,2.41,2.34,2.21,1.81,1.84,1.57,1.65,1.55,1.61,1.61,1.52,1.33,0.45,0.22,0.17,0.19,0.15,0.14,0.13,0.15,0.17,0.14,0.13,0.12,0.15,0.16,0.16,0.2,0.22,0.22,0.24,0.39,0.51,0.68,0.98,1.44,1.91,2.54,2.62,3,3.04,3.25,3.86,4.38,4.5,4.29,4.21,4.53,4.3,4.02,4.13,4.64,4.83,4.9,5.02,5.07,4.88,4.46,4.32,4.54,4.59,4.87,4.86,4.74,4.5,3.97,3.62,3.97]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>inflation_rate<\/th>\n      <th>wage_growth<\/th>\n      <th>us_equity_close<\/th>\n      <th>intl_equity_close<\/th>\n      <th>bond_yield<\/th>\n      <th>short_term_yield<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"date","targets":1},{"name":"inflation_rate","targets":2},{"name":"wage_growth","targets":3},{"name":"us_equity_close","targets":4},{"name":"intl_equity_close","targets":5},{"name":"bond_yield","targets":6},{"name":"short_term_yield","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="initial-analysis" class="level2">
<h2 class="anchored" data-anchor-id="initial-analysis">Initial Analysis</h2>
<p>Now that we have a clean dataset, we can perform some initial analysis to understand the trends and relationships between the variables.</p>
<p>We will visualize the data using line plots and we going to display them in pairs to compare the trends between the variables. so it would be inflation rate and wage growth, US equity and International equity, and Bond Yield and Short-Term Yield.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot for Inflation Rate and Wage Growth with corrected labels and separate y-axes</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Inflation Rate</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> inflation_rate), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Inflation Rate Value (NYC)"</span>,  <span class="co"># Corrected label for inflation rate</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">*</span> <span class="dv">0</span>, <span class="at">name =</span> <span class="st">" "</span>)  <span class="co"># Create empty secondary axis for separation</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Wage Growth (scaled for visibility)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> wage_growth <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Inflation Rate Value (NYC)"</span>,  <span class="co"># Corrected label for wage growth</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Wage Growth (Hourly Earnings in $)"</span>)  <span class="co"># Corrected secondary label</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Inflation Rate and Wage Growth Over Time"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot for US Equity and International Equity</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># US Equity Return</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> us_equity_close), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span>  </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"US Equity Return (Adjusted Close)"</span>  </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># International Equity Return (scaled for visibility)</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> intl_equity_close <span class="sc">*</span> <span class="dv">10</span>), <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span>  </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"US Equity Return (Adjusted Close)"</span>,</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Intl Equity Return"</span>)  </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"US and International Equity Returns Over Time"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot for Bond Yield and Short-Term Yield </span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_data, <span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bond Yield</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> bond_yield <span class="sc">*</span> <span class="dv">2</span>), <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span>  </span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Bond Yield (%)"</span>, </span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">2</span>, <span class="at">name =</span> <span class="st">"Bond Yield (%)"</span>)  </span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Short-Term Yield</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> short_term_yield <span class="sc">*</span> <span class="dv">2</span>), <span class="at">color =</span> <span class="st">"brown"</span>) <span class="sc">+</span>  </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Short-Term Yield (%)"</span>, </span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">2</span>, <span class="at">name =</span> <span class="st">"Short-Term Yield (%)"</span>)  </span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bond Yield and Short-Term Yield Over Time"</span>, <span class="at">x =</span> <span class="st">"Date"</span>) <span class="sc">+</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"brown"</span>, <span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Display all three plots</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see a clear correlation between some of this plots. For example, the inflation rate and wage growth are highly correlated, as well as the US and International Equity Returns.</p>
<section id="correlation-matrix" class="level3">
<h3 class="anchored" data-anchor-id="correlation-matrix">Correlation matrix</h3>
<p>We will calculate the correlation matrix to understand the relationships between the variables. This will help us identify any significant correlations that can inform our analysis and decision-making process.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only numeric columns</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>numeric_data <span class="ot">&lt;-</span> combined_data <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the correlation matrix</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_data, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the correlation matrix using ggcorrplot</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrplot</span>(cor_matrix, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">type =</span> <span class="st">"lower"</span>,          <span class="co"># Only show the lower triangle</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">lab =</span> <span class="cn">TRUE</span>,              <span class="co"># Show correlation coefficient labels</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">lab_size =</span> <span class="dv">3</span>,            <span class="co"># Adjust label size</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">method =</span> <span class="st">"circle"</span>,       <span class="co"># Use circle shapes for correlation values</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"white"</span>, <span class="st">"blue"</span>), <span class="co"># Color scale</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">"Correlation Matrix"</span>, <span class="co"># Plot title</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_minimal</span>(), <span class="co"># Minimalistic theme</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">tl.cex =</span> <span class="dv">12</span>,             <span class="co"># Title label size</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">tl.col =</span> <span class="st">"black"</span>         <span class="co"># Title text color</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this initial analysis we examine the relationships between several key economic factors, including inflation, wage growth, stock market returns (both US and international), bond yields, and short-term debt yields. Understanding how these factors are correlated can provide valuable insights for making informed financial decisions, particularly for retirement planning.</p>
</section>
</section>
<section id="key-findings" class="level2">
<h2 class="anchored" data-anchor-id="key-findings">Key Findings:</h2>
<section id="inflation-rate-and-wage-growth" class="level3">
<h3 class="anchored" data-anchor-id="inflation-rate-and-wage-growth">1. Inflation Rate and Wage Growth:</h3>
<ul>
<li><strong>Correlation</strong>: 0.98 (Very strong)</li>
<li><strong>Interpretation</strong>: When inflation increases, wage growth tends to follow suit. This suggests that as the cost of living rises, your wages are likely to increase as well, which helps you keep up with inflation.</li>
</ul>
</section>
<section id="stock-market-returns" class="level3">
<h3 class="anchored" data-anchor-id="stock-market-returns">2. Stock Market Returns:</h3>
<section id="us-and-international-markets" class="level4">
<h4 class="anchored" data-anchor-id="us-and-international-markets">US and International Markets:</h4>
<ul>
<li><strong>Correlation</strong>: 0.97 (Very strong)</li>
<li><strong>Interpretation</strong>: US and international stock markets have a highly positive correlation, meaning they often move in the same direction. This makes diversification between US and international markets a good strategy for reducing risk while maintaining growth potential.</li>
</ul>
</section>
<section id="us-equity-returns-and-bond-yields" class="level4">
<h4 class="anchored" data-anchor-id="us-equity-returns-and-bond-yields">US Equity Returns and Bond Yields:</h4>
<ul>
<li><strong>Correlation</strong>: 0.68 (Moderate)</li>
<li><strong>Interpretation</strong>: The moderate correlation suggests that when US stocks perform well, bond yields may not follow the same trend. Investors need to balance their portfolios between stocks and bonds, taking into account their risk tolerance and time horizon.</li>
</ul>
</section>
</section>
<section id="inflation-and-other-variables" class="level3">
<h3 class="anchored" data-anchor-id="inflation-and-other-variables">3. Inflation and Other Variables:</h3>
<section id="inflation-and-us-stock-returns" class="level4">
<h4 class="anchored" data-anchor-id="inflation-and-us-stock-returns">Inflation and US Stock Returns:</h4>
<ul>
<li><strong>Correlation</strong>: 0.92 (Strong)</li>
<li><strong>Interpretation</strong>: Inflation and US stock returns are highly correlated. As inflation rises, US stocks tend to perform well, making stocks a potential hedge against inflation.</li>
</ul>
</section>
<section id="inflation-and-international-stock-returns" class="level4">
<h4 class="anchored" data-anchor-id="inflation-and-international-stock-returns">Inflation and International Stock Returns:</h4>
<ul>
<li><strong>Correlation</strong>: 0.97 (Very strong)</li>
<li><strong>Interpretation</strong>: Like US stocks, international stocks also tend to rise with inflation, making global diversification a viable strategy for mitigating inflation risk.</li>
</ul>
</section>
<section id="inflation-and-bond-yields" class="level4">
<h4 class="anchored" data-anchor-id="inflation-and-bond-yields">Inflation and Bond Yields:</h4>
<ul>
<li><strong>Correlation</strong>: 0.72 (Moderate)</li>
<li><strong>Interpretation</strong>: Inflation and bond yields are moderately correlated. Rising inflation generally leads to higher bond yields, which can help protect fixed-income investments from losing purchasing power.</li>
</ul>
</section>
</section>
<section id="bond-yield-and-short-term-yield" class="level3">
<h3 class="anchored" data-anchor-id="bond-yield-and-short-term-yield">4. Bond Yield and Short-Term Yield:</h3>
<ul>
<li><strong>Correlation</strong>: 0.75 (Strong)</li>
<li><strong>Interpretation</strong>: Bond yields and short-term yields tend to move in the same direction, which suggests that both types of bonds respond similarly to changes in interest rates.</li>
</ul>
</section>
</section>
<section id="implications-for-retirement-planning" class="level2">
<h2 class="anchored" data-anchor-id="implications-for-retirement-planning">Implications for Retirement Planning:</h2>
<ul>
<li><p><strong>Wage Growth and Inflation</strong>: The close correlation between wage growth and inflation means that as prices rise, your income should likely increase, helping you maintain purchasing power in retirement.</p></li>
<li><p><strong>Equity Market Performance</strong>: The strong correlation between US and international equity returns allows for diversification between these markets without sacrificing performance.</p></li>
<li><p><strong>Bonds and Short-Term Yields</strong>: Understanding the relationship between bonds and short-term debt yields is crucial for managing fixed-income investments in a rising interest rate environment.</p></li>
</ul>
</section>
<section id="historical-comparison-of-trs-and-orp" class="level1">
<h1>Historical Comparison of TRS and ORP</h1>
<p>Now, we want to compare this two models by evaluating the same initial salary and years of service, in that way we would choose the best model possible. We would have to take the following in consideration:</p>
<section id="initial-setup-and-parameters" class="level2">
<h2 class="anchored" data-anchor-id="initial-setup-and-parameters">Initial Setup and Parameters</h2>
<ul>
<li><strong>Initial Salary</strong>: $60,000.</li>
<li><strong>Years of Service</strong>: 15 years.</li>
<li><strong>Salary Growth</strong>: Modeled using year-over-year CPI growth, calculated from the <code>combined_data</code> dataset.</li>
</ul>
</section>
<section id="trs-teacher-retirement-system-benefit-calculation" class="level2">
<h2 class="anchored" data-anchor-id="trs-teacher-retirement-system-benefit-calculation">TRS (Teacher Retirement System) Benefit Calculation</h2>
<ol type="1">
<li>Calculated annual salaries over the 15-year period by applying CPI growth.</li>
<li>Determined the <strong>Final Average Salary (FAS)</strong> as the average of the last 3 years of salaries.</li>
<li>Computed the <strong>Annual TRS Benefit</strong> based on:
<ul>
<li><strong>Years of Service</strong>:
<ul>
<li>1.67% of FAS for each year of service up to 20 years.</li>
<li>Special rules applied for exactly 20 years or more than 20 years.</li>
</ul></li>
<li><strong>FAS</strong>: Multiplied by the benefit rate and years of service.</li>
</ul></li>
<li>Displayed both the annual and monthly TRS benefits.</li>
</ol>
</section>
<section id="contributions-employee-and-employer" class="level2">
<h2 class="anchored" data-anchor-id="contributions-employee-and-employer">Contributions (Employee and Employer)</h2>
<ol type="1">
<li>Calculated annual employee and employer contributions based on salary and contribution rules:
<ul>
<li><strong>Employee Contributions</strong>:
<ul>
<li>3% to 6% of salary, determined by salary brackets.</li>
</ul></li>
<li><strong>Employer Contributions</strong>:
<ul>
<li>8% for the first 7 years and 10% for subsequent years.</li>
</ul></li>
</ul></li>
<li>Summed contributions for each year and totaled them over the 15-year period.</li>
<li>Stored detailed data in a table for yearly contributions.</li>
</ol>
</section>
<section id="orp-optional-retirement-plan-investment-simulation" class="level2">
<h2 class="anchored" data-anchor-id="orp-optional-retirement-plan-investment-simulation">ORP (Optional Retirement Plan) Investment Simulation</h2>
<ol type="1">
<li><strong>Portfolio Allocation</strong>:
<ul>
<li>Adjusted allocations for US equities, international equities, and bonds based on age brackets:
<ul>
<li>Ages 50-59: Higher equity allocation.</li>
<li>Ages 60-74: Increased bond allocation to have more stability.</li>
</ul></li>
</ul></li>
<li>Calculated annual performance for each asset class using growth rates from the <code>combined_data</code> dataset:
<ul>
<li>US and international equity growth based on stock market performance.</li>
<li>Bond yields calculated as annual averages.</li>
</ul></li>
<li>Simulated yearly portfolio performance using contributions and compound growth.</li>
<li>Computed the <strong>Total Accumulated Value</strong> at the end of 15 years.</li>
<li>Estimated the <strong>Annual ORP Benefit</strong> as 4% of the final accumulated value.</li>
</ol>
<hr>
<p>The following code snippets will calculate the retirement benefits for both TRS and ORP based on the assumptions outlined above. We will compare the monthly benefits and accumulated funds for each plan to provide a comprehensive analysis of the retirement options.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set initial salary and define years of service</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>initial_salary <span class="ot">&lt;-</span> <span class="dv">60000</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>years_of_service <span class="ot">&lt;-</span> <span class="dv">15</span>  <span class="co"># Adjusted to 15 years</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a vector to store salaries for each year</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>salaries <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>salary_growth <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>cpi_growth <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>salary_increase <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the first salary as the initial salary</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>salaries[<span class="dv">1</span>] <span class="ot">&lt;-</span> initial_salary</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the combined data for yearly salary growth calculation</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>years_of_service) {</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We need CPI data for each September to calculate the salary for the next year</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the CPI growth between September (from the previous year) and September of the current year</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  september_cpi_previous_year <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>inflation_rate[<span class="fu">which</span>(<span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span> <span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">2008</span> <span class="sc">+</span> (i <span class="sc">-</span> <span class="dv">1</span>))]</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  september_cpi_current_year <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>inflation_rate[<span class="fu">which</span>(<span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span> <span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">2008</span> <span class="sc">+</span> i)]</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the salary growth rate based on CPI change</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  cpi_growth[i] <span class="ot">&lt;-</span> september_cpi_current_year <span class="sc">/</span> september_cpi_previous_year</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  salary_growth[i] <span class="ot">&lt;-</span> cpi_growth[i]</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the increase in salary</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  salary_increase[i] <span class="ot">&lt;-</span> salaries[i<span class="dv">-1</span>] <span class="sc">*</span> (cpi_growth[i] <span class="sc">-</span> <span class="dv">1</span>)  <span class="co"># Difference from the previous salary</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the salary growth to the previous year's salary</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  salaries[i] <span class="ot">&lt;-</span> salaries[i<span class="dv">-1</span>] <span class="sc">*</span> cpi_growth[i]  </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Final Average Salary (FAS) - which is the average of the last 3 years' salary</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>fas <span class="ot">&lt;-</span> <span class="fu">mean</span>(salaries[(years_of_service<span class="dv">-2</span>)<span class="sc">:</span>years_of_service])</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Annual Retirement Benefit based on years of service</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (years_of_service <span class="sc">&lt;=</span> <span class="dv">20</span>) {</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  annual_benefit_trs <span class="ot">&lt;-</span> <span class="fl">0.0167</span> <span class="sc">*</span> fas <span class="sc">*</span> years_of_service</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (years_of_service <span class="sc">==</span> <span class="dv">20</span>) {</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  annual_benefit_trs <span class="ot">&lt;-</span> <span class="fl">0.0175</span> <span class="sc">*</span> fas <span class="sc">*</span> years_of_service</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  annual_benefit_trs <span class="ot">&lt;-</span> (<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.02</span> <span class="sc">*</span> years_of_service) <span class="sc">*</span> fas</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data for the table</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>trs_benefit_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">Benefit_Type =</span> <span class="fu">c</span>(<span class="st">"Annual TRS Benefit"</span>, <span class="st">"Monthly TRS Benefit"</span>),</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amount =</span> <span class="fu">c</span>(<span class="fu">round</span>(annual_benefit_trs, <span class="dv">2</span>), <span class="fu">round</span>(annual_benefit_trs <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">2</span>))</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and display the table using gt</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>trs_benefit_data <span class="sc">|&gt;</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"TRS Benefit Summary"</span>,</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Annual and Monthly TRS Benefits"</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_currency</span>(</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"Amount"</span>,</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">currency =</span> <span class="st">"USD"</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">Benefit_Type =</span> <span class="st">"Benefit Type"</span>,</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amount =</span> <span class="st">"Amount ($)"</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="st">"medium"</span>,</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">heading.align =</span> <span class="st">"center"</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="vdlpibodhi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vdlpibodhi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vdlpibodhi thead, #vdlpibodhi tbody, #vdlpibodhi tfoot, #vdlpibodhi tr, #vdlpibodhi td, #vdlpibodhi th {
  border-style: none;
}

#vdlpibodhi p {
  margin: 0;
  padding: 0;
}

#vdlpibodhi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: medium;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vdlpibodhi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vdlpibodhi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vdlpibodhi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vdlpibodhi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vdlpibodhi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdlpibodhi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vdlpibodhi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vdlpibodhi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vdlpibodhi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vdlpibodhi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vdlpibodhi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vdlpibodhi .gt_spanner_row {
  border-bottom-style: hidden;
}

#vdlpibodhi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vdlpibodhi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vdlpibodhi .gt_from_md > :first-child {
  margin-top: 0;
}

#vdlpibodhi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vdlpibodhi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vdlpibodhi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vdlpibodhi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vdlpibodhi .gt_row_group_first td {
  border-top-width: 2px;
}

#vdlpibodhi .gt_row_group_first th {
  border-top-width: 2px;
}

#vdlpibodhi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdlpibodhi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vdlpibodhi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vdlpibodhi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdlpibodhi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdlpibodhi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vdlpibodhi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vdlpibodhi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vdlpibodhi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdlpibodhi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vdlpibodhi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdlpibodhi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vdlpibodhi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdlpibodhi .gt_left {
  text-align: left;
}

#vdlpibodhi .gt_center {
  text-align: center;
}

#vdlpibodhi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vdlpibodhi .gt_font_normal {
  font-weight: normal;
}

#vdlpibodhi .gt_font_bold {
  font-weight: bold;
}

#vdlpibodhi .gt_font_italic {
  font-style: italic;
}

#vdlpibodhi .gt_super {
  font-size: 65%;
}

#vdlpibodhi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vdlpibodhi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vdlpibodhi .gt_indent_1 {
  text-indent: 5px;
}

#vdlpibodhi .gt_indent_2 {
  text-indent: 10px;
}

#vdlpibodhi .gt_indent_3 {
  text-indent: 15px;
}

#vdlpibodhi .gt_indent_4 {
  text-indent: 20px;
}

#vdlpibodhi .gt_indent_5 {
  text-indent: 25px;
}

#vdlpibodhi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#vdlpibodhi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="2" class="gt_heading gt_title gt_font_normal">TRS Benefit Summary</th>
</tr>
<tr class="odd gt_heading">
<th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Annual and Monthly TRS Benefits</th>
</tr>
<tr class="header gt_col_headings">
<th id="Benefit Type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Benefit Type</th>
<th id="Amount ($)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Amount ($)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Benefit_Type">Annual TRS Benefit</td>
<td class="gt_row gt_right" headers="Amount">$21,233.31</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Benefit_Type">Monthly TRS Benefit</td>
<td class="gt_row gt_right" headers="Amount">$1,769.44</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can notice the money a professor would get from the TRS plan. Now we would calculate the contributions for the OPR plan.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize parameters</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>initial_salary <span class="ot">&lt;-</span> <span class="dv">60000</span>  <span class="co"># Starting salary</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>years_of_service <span class="ot">&lt;-</span> <span class="dv">15</span>   <span class="co"># Number of years to simulate</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up salary contribution brackets</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>salary_brackets <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">45000</span>, <span class="dv">55000</span>, <span class="dv">75000</span>, <span class="dv">100000</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store results</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>salaries <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>employee_contributions <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>employer_contributions <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>total_contributions <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the first year's salary</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>salaries[<span class="dv">1</span>] <span class="ot">&lt;-</span> initial_salary</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year and compute the contributions</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_of_service) {</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the salary for the year</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">&lt;-</span> initial_salary</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate salary growth based on CPI (only starting from the second year)</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    september_cpi_previous_year <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>inflation_rate[<span class="fu">which</span>(<span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span> <span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">2009</span> <span class="sc">+</span> (i <span class="sc">-</span> <span class="dv">1</span>))]</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    september_cpi_current_year <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>inflation_rate[<span class="fu">which</span>(<span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">9</span> <span class="sc">&amp;</span> <span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">2009</span> <span class="sc">+</span> i)]</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the salary growth rate based on CPI change (year over year growth)</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    cpi_growth <span class="ot">&lt;-</span> september_cpi_current_year <span class="sc">/</span> september_cpi_previous_year</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    salary <span class="ot">&lt;-</span> salaries[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> cpi_growth  <span class="co"># Update salary based on CPI growth</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the salary for each year</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  salaries[i] <span class="ot">&lt;-</span> salary</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Employee contribution calculation based on salary brackets (annual contribution)</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (salary <span class="sc">&lt;=</span> salary_brackets[<span class="dv">1</span>]) {</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    employee_contribution_annual <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fl">0.03</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (salary <span class="sc">&lt;=</span> salary_brackets[<span class="dv">2</span>]) {</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    employee_contribution_annual <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fl">0.035</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (salary <span class="sc">&lt;=</span> salary_brackets[<span class="dv">3</span>]) {</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    employee_contribution_annual <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fl">0.045</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (salary <span class="sc">&lt;=</span> salary_brackets[<span class="dv">4</span>]) {</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    employee_contribution_annual <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fl">0.0575</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>    employee_contribution_annual <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fl">0.06</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Employer contribution: 8% for the first 7 years, 10% after (annual contribution)</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;=</span> <span class="dv">7</span>) {</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    employer_contribution_annual <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fl">0.08</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    employer_contribution_annual <span class="ot">&lt;-</span> salary <span class="sc">*</span> <span class="fl">0.10</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total contribution for the year</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  total_contribution_annual <span class="ot">&lt;-</span> employee_contribution_annual <span class="sc">+</span> employer_contribution_annual</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store contributions</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>  employee_contributions[i] <span class="ot">&lt;-</span> employee_contribution_annual</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>  employer_contributions[i] <span class="ot">&lt;-</span> employer_contribution_annual</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>  total_contributions[i] <span class="ot">&lt;-</span> total_contribution_annual</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table with the results for each year</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>yearly_contributions_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">1</span><span class="sc">:</span>years_of_service,</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">Salary =</span> <span class="fu">round</span>(salaries, <span class="dv">2</span>),</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">Employee_Contribution =</span> <span class="fu">round</span>(employee_contributions, <span class="dv">2</span>),</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">Employer_Contribution =</span> <span class="fu">round</span>(employer_contributions, <span class="dv">2</span>),</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total_Contribution =</span> <span class="fu">round</span>(total_contributions, <span class="dv">2</span>)</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cumulative contributions</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>yearly_contributions_data<span class="sc">$</span>Cumulative_Employee_Contribution <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(yearly_contributions_data<span class="sc">$</span>Employee_Contribution)</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>yearly_contributions_data<span class="sc">$</span>Cumulative_Employer_Contribution <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(yearly_contributions_data<span class="sc">$</span>Employer_Contribution)</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>yearly_contributions_data<span class="sc">$</span>Cumulative_Total_Contribution <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(yearly_contributions_data<span class="sc">$</span>Total_Contribution)</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization for cumulative contributions</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yearly_contributions_data, <span class="fu">aes</span>(<span class="at">x =</span> Year)) <span class="sc">+</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cumulative_Employee_Contribution, <span class="at">color =</span> <span class="st">"Cumulative Employee Contribution"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cumulative_Employer_Contribution, <span class="at">color =</span> <span class="st">"Cumulative Employer Contribution"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cumulative_Total_Contribution, <span class="at">color =</span> <span class="st">"Cumulative Total Contribution"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cumulative Contributions Over Time"</span>,</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of Service"</span>,</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Cumulative Contribution Amount ($)"</span>,</span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Legend"</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize parameters for ORP calculations</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Age 50 to 59</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>equity_us_alloc_50_59 <span class="ot">&lt;-</span> <span class="fl">0.47</span>  <span class="co"># US Equities allocation</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>equity_international_alloc_50_59 <span class="ot">&lt;-</span> <span class="fl">0.32</span>  <span class="co"># International Equities allocation</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>bonds_alloc_50_59 <span class="ot">&lt;-</span> <span class="fl">0.21</span>  <span class="co"># Bonds allocation</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Age 60 to 74</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>equity_us_alloc_60_74 <span class="ot">&lt;-</span> <span class="fl">0.34</span>  <span class="co"># US Equities allocation</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>equity_international_alloc_60_74 <span class="ot">&lt;-</span> <span class="fl">0.23</span>  <span class="co"># International Equities allocation</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>bonds_alloc_60_74 <span class="ot">&lt;-</span> <span class="fl">0.43</span>  <span class="co"># Bonds allocation</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store results</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>performance_us_equity <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>performance_international_equity <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>performance_bonds <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>total_accumulated <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_of_service)  <span class="co"># Total accumulated amount</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting balance</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>total_accumulated[<span class="dv">1</span>] <span class="ot">&lt;-</span> yearly_contributions_data<span class="sc">$</span>Total_Contribution[<span class="dv">1</span>]</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Start contributing at age 50 in 2009</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>starting_age <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each year to compute performance</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_of_service) {</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  current_year <span class="ot">&lt;-</span> <span class="dv">2009</span> <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Current year</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  next_year <span class="ot">&lt;-</span> current_year <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># Next year</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  current_age <span class="ot">&lt;-</span> starting_age <span class="sc">+</span> i <span class="sc">-</span> <span class="dv">1</span>  <span class="co"># Current age</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign allocations based on age</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (current_age <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;&amp;</span> current_age <span class="sc">&lt;=</span> <span class="dv">59</span>) {</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    equity_us_alloc <span class="ot">&lt;-</span> equity_us_alloc_50_59</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    equity_international_alloc <span class="ot">&lt;-</span> equity_international_alloc_50_59</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    bonds_alloc <span class="ot">&lt;-</span> bonds_alloc_50_59</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (current_age <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;&amp;</span> current_age <span class="sc">&lt;=</span> <span class="dv">74</span>) {</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    equity_us_alloc <span class="ot">&lt;-</span> equity_us_alloc_60_74</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    equity_international_alloc <span class="ot">&lt;-</span> equity_international_alloc_60_74</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    bonds_alloc <span class="ot">&lt;-</span> bonds_alloc_60_74</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure we have data for the future January, or use November of the current year if not available</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> years_of_service) {</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For the last year, use November data instead of January of the next year</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    us_equity_growth <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>us_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">11</span>)] <span class="sc">/</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>                        combined_data<span class="sc">$</span>us_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">1</span>)]</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    intl_equity_growth <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>intl_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">11</span>)] <span class="sc">/</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>                          combined_data<span class="sc">$</span>intl_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">1</span>)]</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    bond_yield_annual <span class="ot">&lt;-</span> <span class="fu">mean</span>(combined_data<span class="sc">$</span>bond_yield[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">&lt;=</span> <span class="dv">11</span>)]) <span class="sc">/</span> <span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For all other years, use January of the next year</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    us_equity_growth <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>us_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> next_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">1</span>)] <span class="sc">/</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>                        combined_data<span class="sc">$</span>us_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">1</span>)]</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    intl_equity_growth <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>intl_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> next_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">1</span>)] <span class="sc">/</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>                          combined_data<span class="sc">$</span>intl_equity_close[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year <span class="sc">&amp;</span> <span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">1</span>)]</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    bond_yield_annual <span class="ot">&lt;-</span> <span class="fu">mean</span>(combined_data<span class="sc">$</span>bond_yield[<span class="fu">which</span>(<span class="fu">year</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> current_year)]) <span class="sc">/</span> <span class="dv">100</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store individual performance values</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  performance_us_equity[i] <span class="ot">&lt;-</span> us_equity_growth</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  performance_international_equity[i] <span class="ot">&lt;-</span> intl_equity_growth</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  performance_bonds[i] <span class="ot">&lt;-</span> bond_yield_annual  <span class="co"># Already adjusted with +1</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate total accumulated with contributions and compound effect</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First year: Apply performance to the first contribution</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>    total_accumulated[i] <span class="ot">&lt;-</span> yearly_contributions_data<span class="sc">$</span>Total_Contribution[i] <span class="sc">*</span> (</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>                              (equity_us_alloc <span class="sc">*</span> performance_us_equity[i]) <span class="sc">+</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>                              (equity_international_alloc <span class="sc">*</span> performance_international_equity[i]) <span class="sc">+</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>                              (bonds_alloc <span class="sc">*</span> performance_bonds[i])</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Subsequent years: Include previous accumulated total and current contributions</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>    total_accumulated[i] <span class="ot">&lt;-</span> (total_accumulated[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> yearly_contributions_data<span class="sc">$</span>Total_Contribution[i]) <span class="sc">*</span> (</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>                              (equity_us_alloc <span class="sc">*</span> performance_us_equity[i]) <span class="sc">+</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>                              (equity_international_alloc <span class="sc">*</span> performance_international_equity[i]) <span class="sc">+</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>                              (bonds_alloc <span class="sc">*</span> performance_bonds[i])</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with the results</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>yearly_performance_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">2009</span><span class="sc">:</span>(<span class="dv">2009</span> <span class="sc">+</span> years_of_service <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">Age =</span> starting_age<span class="sc">:</span>(starting_age <span class="sc">+</span> years_of_service <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">US_Equity_Performance =</span> <span class="fu">round</span>(performance_us_equity, <span class="dv">4</span>),</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">International_Equity_Performance =</span> <span class="fu">round</span>(performance_international_equity, <span class="dv">4</span>),</span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bonds_Performance =</span> <span class="fu">round</span>(performance_bonds, <span class="dv">4</span>),</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total_Accumulated =</span> <span class="fu">round</span>(total_accumulated, <span class="dv">2</span>)</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>annual_benefit_opr <span class="ot">&lt;-</span> <span class="fl">0.04</span> <span class="sc">*</span> yearly_performance_data<span class="sc">$</span>Total_Accumulated[years_of_service]</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>monthly_benefit_opr <span class="ot">&lt;-</span> annual_benefit_opr <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>opr_benefit_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Annual OPR Benefit"</span>, <span class="st">"Monthly OPR Benefit"</span>),</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amount =</span> <span class="fu">c</span>(<span class="fu">round</span>(annual_benefit_opr, <span class="dv">2</span>), <span class="fu">round</span>(monthly_benefit_opr, <span class="dv">2</span>))</span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>opr_benefit_table <span class="sc">|&gt;</span></span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"OPR Benefit Summary"</span>,</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Year"</span>, years_of_service, <span class="st">"Calculation"</span>)</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_currency</span>(</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"Amount"</span>,</span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">currency =</span> <span class="st">"USD"</span></span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">Metric =</span> <span class="st">"Benefit Type"</span>,</span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amount =</span> <span class="st">"Amount ($)"</span></span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">list</span>(</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>)</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="fu">everything</span>())</span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="sgtnilizld" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#sgtnilizld table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sgtnilizld thead, #sgtnilizld tbody, #sgtnilizld tfoot, #sgtnilizld tr, #sgtnilizld td, #sgtnilizld th {
  border-style: none;
}

#sgtnilizld p {
  margin: 0;
  padding: 0;
}

#sgtnilizld .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sgtnilizld .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sgtnilizld .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sgtnilizld .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sgtnilizld .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sgtnilizld .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sgtnilizld .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sgtnilizld .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sgtnilizld .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sgtnilizld .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sgtnilizld .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sgtnilizld .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sgtnilizld .gt_spanner_row {
  border-bottom-style: hidden;
}

#sgtnilizld .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sgtnilizld .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sgtnilizld .gt_from_md > :first-child {
  margin-top: 0;
}

#sgtnilizld .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sgtnilizld .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sgtnilizld .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sgtnilizld .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sgtnilizld .gt_row_group_first td {
  border-top-width: 2px;
}

#sgtnilizld .gt_row_group_first th {
  border-top-width: 2px;
}

#sgtnilizld .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sgtnilizld .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sgtnilizld .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sgtnilizld .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sgtnilizld .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sgtnilizld .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sgtnilizld .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sgtnilizld .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sgtnilizld .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sgtnilizld .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sgtnilizld .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sgtnilizld .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sgtnilizld .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sgtnilizld .gt_left {
  text-align: left;
}

#sgtnilizld .gt_center {
  text-align: center;
}

#sgtnilizld .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sgtnilizld .gt_font_normal {
  font-weight: normal;
}

#sgtnilizld .gt_font_bold {
  font-weight: bold;
}

#sgtnilizld .gt_font_italic {
  font-style: italic;
}

#sgtnilizld .gt_super {
  font-size: 65%;
}

#sgtnilizld .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sgtnilizld .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sgtnilizld .gt_indent_1 {
  text-indent: 5px;
}

#sgtnilizld .gt_indent_2 {
  text-indent: 10px;
}

#sgtnilizld .gt_indent_3 {
  text-indent: 15px;
}

#sgtnilizld .gt_indent_4 {
  text-indent: 20px;
}

#sgtnilizld .gt_indent_5 {
  text-indent: 25px;
}

#sgtnilizld .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#sgtnilizld div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="2" class="gt_heading gt_title gt_font_normal">OPR Benefit Summary</th>
</tr>
<tr class="odd gt_heading">
<th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Year 15 Calculation</th>
</tr>
<tr class="header gt_col_headings">
<th id="Benefit Type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Benefit Type</th>
<th id="Amount ($)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Amount ($)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Metric">Annual OPR Benefit</td>
<td class="gt_row gt_right" headers="Amount">$10,600.32</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Metric">Monthly OPR Benefit</td>
<td class="gt_row gt_right" headers="Amount">$883.36</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total accumulated contributions over time</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>total_contributions <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(yearly_contributions_data<span class="sc">$</span>Total_Contribution)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for plotting</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="dv">2009</span><span class="sc">:</span>(<span class="dv">2009</span> <span class="sc">+</span> years_of_service <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total_Accumulated =</span> total_accumulated,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total_Contributions =</span> total_contributions</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive graph</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(plot_data, <span class="at">x =</span> <span class="sc">~</span>Year) <span class="sc">|&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span>Total_Accumulated, <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines+markers'</span>, <span class="at">name =</span> <span class="st">'Compounding $'</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">hovertemplate =</span> <span class="st">'Year: %{x}&lt;br&gt;Total Accumulated: %{y:.2f}&lt;extra&gt;&lt;/extra&gt;'</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span>Total_Contributions, <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines+markers'</span>, <span class="at">name =</span> <span class="st">'Total Contributions'</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">hovertemplate =</span> <span class="st">'Year: %{x}&lt;br&gt;Total Contributions: %{y:.2f}&lt;extra&gt;&lt;/extra&gt;'</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">'Interactive Graph: Total Accumulation vs. Contributions'</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Year'</span>),</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'Amount ($)'</span>),</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">'h'</span>, <span class="at">x =</span> <span class="fl">0.5</span>, <span class="at">xanchor =</span> <span class="st">'center'</span>)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-88b2e6f30dc80bdc0839" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-88b2e6f30dc80bdc0839">{"x":{"visdat":{"5c39134e8c5":["function () ","plotlyVisDat"]},"cur_data":"5c39134e8c5","attrs":{"5c39134e8c5":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"scatter","mode":"lines+markers","name":"Compounding $","hovertemplate":"Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","inherit":true},"5c39134e8c5.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"scatter","mode":"lines+markers","name":"Total Contributions","hovertemplate":"Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Interactive Graph: Total Accumulation vs. Contributions","xaxis":{"domain":[0,1],"automargin":true,"title":"Year"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Amount ($)"},"legend":{"orientation":"h","x":0.5,"xanchor":"center"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023],"y":[9667.8046638616925,20318.66356997862,28125.655823449208,41018.798099438871,56184.03536101932,69060.707213809685,75914.85763234258,97884.923311721475,131834.47996593051,136066.30144392225,162605.0246876858,190899.44905197073,225579.59174354325,233721.18185982766,265007.99000933592],"type":"scatter","mode":"lines+markers","name":"Compounding $","hovertemplate":["Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Accumulated: %{y:.2f}<extra><\/extra>"],"marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023],"y":[7500,15263.24,23193.5,31227.760000000002,39423.620000000003,47698.760000000002,56142.270000000004,66222.450000000012,76640.600000000006,87333.840000000011,98196.850000000006,110620.84000000001,124071.02000000002,138050.51000000001,152318.99000000002],"type":"scatter","mode":"lines+markers","name":"Total Contributions","hovertemplate":["Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>","Year: %{x}<br>Total Contributions: %{y:.2f}<extra><\/extra>"],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>In this image we can see clearly the power of compounding. The total accumulated amount grows over time due to the contributions and the compound effect of the investment returns. This visualization provides a clear representation of how the retirement savings can grow over the years, highlighting the importance of consistent contributions and wise investment choices.</p>
</section>
<section id="comparative-analysis-of-trs-and-orp" class="level2">
<h2 class="anchored" data-anchor-id="comparative-analysis-of-trs-and-orp">Comparative Analysis of TRS and ORP</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate monthly benefits</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>monthly_benefit_opr <span class="ot">&lt;-</span> annual_benefit_opr <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>monthly_benefit_trs <span class="ot">&lt;-</span> annual_benefit_trs <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for plotting</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>benefit_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Benefit_Type =</span> <span class="fu">c</span>(<span class="st">"Monthly OPR Benefit"</span>, <span class="st">"Monthly TRS Benefit"</span>),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amount =</span> <span class="fu">c</span>(monthly_benefit_opr, monthly_benefit_trs)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar plot</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>benefit_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(benefit_data, <span class="fu">aes</span>(<span class="at">x =</span> Benefit_Type, <span class="at">y =</span> Amount, <span class="at">fill =</span> Benefit_Type)) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"$"</span>, <span class="fu">round</span>(Amount, <span class="dv">2</span>))), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of Monthly OPR and TRS Benefits"</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Benefit Type"</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Amount ($)"</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(benefit_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The bar chart illustrates a comparison between the <strong>Monthly OPR Benefit</strong> and the <strong>Monthly TRS Benefit</strong>. Key insights from the visualization are as follows:</p>
<ol type="1">
<li><strong>Monthly OPR Benefit</strong>:
<ul>
<li>The monthly benefit derived from the OPR system is <strong>$883.35</strong>, as shown by the first bar.</li>
<li>This represents a smaller portion compared to the TRS benefit, reflecting the structure of OPR benefit allocations.</li>
</ul></li>
<li><strong>Monthly TRS Benefit</strong>:
<ul>
<li>The monthly benefit derived from the TRS system is <strong>$1769.43</strong>, as shown by the taller second bar.</li>
<li>This indicates a significantly higher payout, suggesting that the TRS system may provide a more robust financial benefit for retirees compared to the OPR system.</li>
</ul></li>
<li><strong>Comparison</strong>:
<ul>
<li>The TRS benefit is nearly double the OPR benefit, highlighting a substantial disparity between the two systems in terms of monthly payouts.</li>
</ul></li>
</ol>
<p>This comparison provides valuable insight into the financial implications of selecting between the OPR and TRS systems, with the TRS system offering higher monthly benefits. This can serve as a crucial factor for decision-making in retirement planning.</p>
</section>
<section id="fixed-rate-analysis" class="level2">
<h2 class="anchored" data-anchor-id="fixed-rate-analysis">Fixed-Rate Analysis</h2>
<p>To modify the simulation and project an employee’s pension benefit (TRS) or withdrawal amount (ORP) from retirement until death, we need to consider several key factors:</p>
<ol type="1">
<li><strong>Retirement Age</strong>: The age at which the employee retires and begins receiving benefits.</li>
<li><strong>Death Age</strong>: The estimated age at which the employee will pass away.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">65</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>death_age <span class="ot">&lt;-</span> <span class="dv">90</span>  <span class="co"># Estimated death age</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>years_in_retirement <span class="ot">&lt;-</span> death_age <span class="sc">-</span> retirement_age</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the mean weighted performance</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>mean_performance <span class="ot">&lt;-</span> <span class="fu">mean</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  (equity_us_alloc <span class="sc">*</span> yearly_performance_data<span class="sc">$</span>US_Equity_Performance) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  (equity_international_alloc <span class="sc">*</span> yearly_performance_data<span class="sc">$</span>International_Equity_Performance) <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  (bonds_alloc <span class="sc">*</span> yearly_performance_data<span class="sc">$</span>Bonds_Performance),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Use this value as your fixed return rate for ORP</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>fixed_return_rate <span class="ot">&lt;-</span> (mean_performance<span class="dv">-1</span>) <span class="co">#based on the performance of from the last 15 years of investments. </span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixed rate assumptions</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>fixed_return_rate <span class="ot">&lt;-</span> fixed_return_rate  <span class="co"># Fixed annual return rate for ORP</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span>  <span class="co"># Initial ORP withdrawal rate</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the average inflation from the combined_data dataset</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>avg_inflation <span class="ot">&lt;-</span> <span class="fu">mean</span>(combined_data<span class="sc">$</span>inflation_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">100</span>  <span class="co"># Convert to decimal form</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Starting values</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>trs_annual_benefit <span class="ot">&lt;-</span> annual_benefit_trs  <span class="co"># TRS annual benefit</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>orp_balance <span class="ot">&lt;-</span> yearly_performance_data<span class="sc">$</span>Total_Accumulated[years_of_service]  <span class="co"># ORP final balance at retirement</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors to store results</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>trs_benefits <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_in_retirement)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>orp_withdrawals <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_in_retirement)</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>orp_balances <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_in_retirement)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>income_gaps <span class="ot">&lt;-</span> <span class="fu">numeric</span>(years_in_retirement)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (year <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_in_retirement) {</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># TRS Benefit (adjusted for inflation with caps)</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>    trs_benefits[year] <span class="ot">&lt;-</span> trs_annual_benefit</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    cpi_adjustment <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">min</span>(avg_inflation <span class="sc">*</span> <span class="fl">0.5</span>, <span class="fl">0.03</span>), <span class="fl">0.01</span>)  <span class="co"># Cap between 1% and 3%</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    trs_benefits[year] <span class="ot">&lt;-</span> trs_benefits[year <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> cpi_adjustment)</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ORP Withdrawal: Fixed percentage of the previous year's balance</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    orp_withdrawals[year] <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> withdrawal_rate</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    orp_balance <span class="ot">&lt;-</span> orp_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> fixed_return_rate) <span class="sc">-</span> orp_withdrawals[year]</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    orp_withdrawals[year] <span class="ot">&lt;-</span> orp_balances[year <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">*</span> withdrawal_rate</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    orp_balance <span class="ot">&lt;-</span> (orp_balances[year <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">-</span> orp_withdrawals[year]) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> fixed_return_rate)</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure balance never goes negative</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  orp_balances[year] <span class="ot">&lt;-</span> <span class="fu">max</span>(orp_balance, <span class="dv">0</span>)</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (orp_balance <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>    orp_withdrawals[year] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Income gap (Annually)</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>  income_gaps[year] <span class="ot">&lt;-</span> trs_benefits[year] <span class="sc">-</span> orp_withdrawals[year]</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Create results data frame</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> retirement_age<span class="sc">:</span>(death_age <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">TRS_Annual_Income =</span> trs_benefits,</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">ORP_Annual_Withdrawal =</span> orp_withdrawals,</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">ORP_Balance_Remaining =</span> orp_balances,</span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">Income_Gap_Annual =</span> income_gaps</span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for visualization</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>graph_data <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Year, TRS_Annual_Income, ORP_Annual_Withdrawal, ORP_Balance_Remaining) <span class="sc">|&gt;</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(TRS_Annual_Income, ORP_Annual_Withdrawal),</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Plan"</span>,</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Annual_Income"</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">Plan =</span> <span class="fu">recode</span>(</span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>      Plan, </span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">TRS_Annual_Income =</span> <span class="st">"TRS Annual Income"</span>, </span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">ORP_Annual_Withdrawal =</span> <span class="st">"ORP Annual Withdrawal"</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot TRS and ORP incomes over time</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>income_plot <span class="ot">&lt;-</span> graph_data <span class="sc">|&gt;</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Annual_Income, <span class="at">color =</span> Plan, <span class="at">group =</span> Plan)) <span class="sc">+</span></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of TRS and ORP Annual Income Over Time"</span>,</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of Retirement"</span>,</span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Annual Income ($)"</span>,</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Retirement Plan"</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>())</span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plots</span></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>income_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparison-of-trs-and-orp-income" class="level2">
<h2 class="anchored" data-anchor-id="comparison-of-trs-and-orp-income">Comparison of TRS and ORP Income</h2>
<ol type="1">
<li><strong>TRS Income</strong>:
<ul>
<li>TRS income grows steadily, driven by inflation adjustments, ensuring higher and more consistent income throughout retirement.</li>
</ul></li>
<li><strong>ORP Withdrawals</strong>:
<ul>
<li>ORP withdrawals grow modestly and lack inflation adjustments, leading to slower income growth over time.</li>
</ul></li>
<li><strong>Income Gap</strong>:
<ul>
<li>The gap between TRS and ORP widens significantly, with TRS consistently providing higher income.</li>
</ul></li>
<li><strong>Key Insight</strong>:
<ul>
<li>TRS is better for retirees needing stable, inflation-protected income, while ORP offers lower growth and purchasing power over time.</li>
</ul></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ORP remaining balance over time</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>orp_balance_plot <span class="ot">&lt;-</span> results <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> ORP_Balance_Remaining)) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Growth of ORP Investment Balance Over Time"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of Retirement"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"ORP Balance Remaining ($)"</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>())</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the ORP balance plot</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>orp_balance_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>While TRS may provide a higher and more stable income, the ORP plan demonstrates strong growth in its investment balance over time. This highlights the plan’s long-term sustainability. Additionally, ORP offers greater flexibility, giving employees more control over their investments.</p>
<p>One key advantage of ORP is that employees can access the full balance if needed, providing the freedom to use the funds as desired, whether for unexpected expenses, large purchases, or other financial goals. This flexibility makes ORP a viable option for those who value control over their retirement savings.</p>
</section>
</section>
<section id="monte-carlo-simulation-for-orp-plan-retirement-benefits" class="level1">
<h1>Monte Carlo Simulation for ORP Plan Retirement Benefits</h1>
<p>Monte Carlo simulation is a powerful tool to model the range of possible outcomes for the ORP (Optional Retirement Plan) benefits. By generating multiple scenarios based on random samples of historical data (created using bootstrapping), this approach allows us to evaluate the robustness and performance of the ORP plan under varying conditions.</p>
<section id="simulation-overview" class="level2">
<h2 class="anchored" data-anchor-id="simulation-overview"><strong>Simulation Overview</strong></h2>
<p>We aim to assess the impact of market conditions and withdrawal rates on the ORP balance over time and evaluate the plan’s sustainability under different scenarios.</p>
<section id="key-considerations" class="level3">
<h3 class="anchored" data-anchor-id="key-considerations"><strong>Key Considerations</strong></h3>
<ul>
<li><strong>Death Age</strong>: 90 years<br>
</li>
<li><strong>Retirement Age</strong>: 65 years<br>
</li>
<li><strong>Withdrawal Rates</strong>: 3% to 10%
<ul>
<li>We will evaluate the impact of different withdrawal rates on the ORP balance over time.<br>
</li>
</ul></li>
<li><strong>Number of Simulations</strong>: 200
<ul>
<li>This ensures a comprehensive analysis by capturing a wide range of potential outcomes.</li>
</ul></li>
</ul>
</section>
<section id="objectives-1" class="level3">
<h3 class="anchored" data-anchor-id="objectives-1"><strong>Objectives</strong></h3>
<ol type="1">
<li><strong>Simulate Market Conditions</strong>:<br>
Use bootstrapped historical data to reflect various possible market scenarios.</li>
<li><strong>Evaluate Withdrawal Strategies</strong>:<br>
Analyze how different withdrawal rates impact the sustainability of the ORP plan.</li>
<li><strong>Assess Performance</strong>:<br>
Provide insights into the range of possible retirement benefits and identify risks or trends under varying scenarios.</li>
</ol>
<p>This analysis will allow for a better understanding of the ORP plan’s robustness and help in making informed decisions for financial planning in retirement.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>retirement_age <span class="ot">&lt;-</span> <span class="dv">65</span>  <span class="co"># Retirement start age</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>death_age <span class="ot">&lt;-</span> <span class="dv">90</span>       <span class="co"># End of simulation age</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>years_in_retirement <span class="ot">&lt;-</span> death_age <span class="sc">-</span> retirement_age</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Initial ORP Balance</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>orp_balance <span class="ot">&lt;-</span> yearly_performance_data<span class="sc">$</span>Total_Accumulated[<span class="fu">nrow</span>(yearly_performance_data)]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (orp_balance <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">is.na</span>(orp_balance)) <span class="fu">stop</span>(<span class="st">"ERROR: ORP Balance is zero or NA."</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Portfolio allocations</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>equity_us_alloc <span class="ot">&lt;-</span> <span class="fl">0.34</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>equity_international_alloc <span class="ot">&lt;-</span> <span class="fl">0.23</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>bonds_alloc <span class="ot">&lt;-</span> <span class="fl">0.43</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> ((equity_us_alloc <span class="sc">+</span> equity_international_alloc <span class="sc">+</span> bonds_alloc) <span class="sc">!=</span> <span class="dv">1</span>) <span class="fu">stop</span>(<span class="st">"ERROR: Allocations must sum to 1."</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Bootstrap CPI Growth</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>september_cpi <span class="ot">&lt;-</span> combined_data<span class="sc">$</span>inflation_rate[<span class="fu">month</span>(combined_data<span class="sc">$</span>date) <span class="sc">==</span> <span class="dv">9</span>]</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>cpi_growth <span class="ot">&lt;-</span> september_cpi[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">/</span> september_cpi[<span class="sc">-</span><span class="fu">length</span>(september_cpi)] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>sampled_inflation <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">200</span>, <span class="fu">sample</span>(cpi_growth, years_in_retirement, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Sample Returns</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>sampled_us_returns <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">200</span>, <span class="fu">sample</span>(yearly_performance_data<span class="sc">$</span>US_Equity_Performance, years_in_retirement, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>sampled_intl_returns <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">200</span>, <span class="fu">sample</span>(yearly_performance_data<span class="sc">$</span>International_Equity_Performance, years_in_retirement, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>sampled_bond_returns <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">200</span>, <span class="fu">sample</span>(yearly_performance_data<span class="sc">$</span>Bonds_Performance, years_in_retirement, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Simulate for Withdrawal Rates (3% to 10%)</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>withdrawal_rates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.03</span>, <span class="fl">0.10</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>trs_benefits <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">200</span>, <span class="at">ncol =</span> years_in_retirement)</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize storage for all results</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>all_withdrawal_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>all_balance_results <span class="ot">&lt;-</span> <span class="fu">list</span>()  <span class="co"># To store ORP balances for each withdrawal rate</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (rate <span class="cf">in</span> withdrawal_rates) {</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>  orp_withdrawals <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">200</span>, <span class="at">ncol =</span> years_in_retirement)  <span class="co"># Store withdrawals</span></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  orp_balances <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">200</span>, <span class="at">ncol =</span> years_in_retirement)    <span class="co"># Store balances for each withdrawal rate</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sim <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>) {</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    orp_sim_balance <span class="ot">&lt;-</span> orp_balance  <span class="co"># Reset balance for each simulation</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (year <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_in_retirement) {</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># TRS Benefit Adjustment</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (year <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>        trs_benefit <span class="ot">&lt;-</span> trs_annual_benefit</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>        inflation_adjustment <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">max</span>(sampled_inflation[year, sim] <span class="sc">*</span> <span class="fl">0.5</span>, <span class="fl">0.01</span>), <span class="fl">0.03</span>)</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>        trs_benefit <span class="ot">&lt;-</span> trs_benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> inflation_adjustment)</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>      trs_benefits[sim, year] <span class="ot">&lt;-</span> trs_benefit</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ORP Withdrawal Calculation</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>      withdrawal <span class="ot">&lt;-</span> orp_sim_balance <span class="sc">*</span> rate</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>      orp_withdrawals[sim, year] <span class="ot">&lt;-</span> withdrawal</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>      remaining_balance <span class="ot">&lt;-</span> <span class="fu">max</span>(orp_sim_balance <span class="sc">-</span> withdrawal, <span class="dv">0</span>)</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>      orp_balances[sim, year] <span class="ot">&lt;-</span> remaining_balance  <span class="co"># Save balance for the simulation</span></span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (remaining_balance <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="cf">break</span>  <span class="co"># Stop simulation if balance is depleted</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Apply Weighted Returns</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>      weighted_return <span class="ot">&lt;-</span> (equity_us_alloc <span class="sc">*</span> (sampled_us_returns[year, sim] <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>                         (equity_international_alloc <span class="sc">*</span> (sampled_intl_returns[year, sim] <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>                         (bonds_alloc <span class="sc">*</span> (sampled_bond_returns[year, sim] <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>      orp_sim_balance <span class="ot">&lt;-</span> remaining_balance <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> weighted_return)</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store Average Withdrawals</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>  avg_withdrawals <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(orp_withdrawals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> retirement_age<span class="sc">:</span>(death_age <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">Average_Withdrawal =</span> avg_withdrawals,</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">Withdrawal_Rate =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(rate <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>  all_withdrawal_results[[<span class="fu">paste0</span>(<span class="st">"Rate_"</span>, <span class="fu">round</span>(rate <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))]] <span class="ot">&lt;-</span> result</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the ORP Balances for the Current Rate</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>  all_balance_results[[<span class="fu">paste0</span>(<span class="st">"Rate_"</span>, <span class="fu">round</span>(rate <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))]] <span class="ot">&lt;-</span> orp_balances</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine Withdrawal Results for Visualization</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>combined_withdrawal_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_withdrawal_results)</span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Add TRS Results</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>combined_trs_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> retirement_age<span class="sc">:</span>(death_age <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">Average_Withdrawal =</span> <span class="fu">colMeans</span>(trs_benefits, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">Withdrawal_Rate =</span> <span class="st">"TRS Benefit"</span>,</span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">Line_Type =</span> <span class="st">"dashed"</span>,</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">Legend =</span> <span class="st">"TRS Benefit"</span></span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust ORP Results for Consistency</span></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>combined_withdrawal_results<span class="sc">$</span>Line_Type <span class="ot">&lt;-</span> <span class="st">"solid"</span></span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>combined_withdrawal_results<span class="sc">$</span>Legend <span class="ot">&lt;-</span> combined_withdrawal_results<span class="sc">$</span>Withdrawal_Rate</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge Results</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>final_combined_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(combined_withdrawal_results, combined_trs_results)</span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>final_combined_results<span class="sc">$</span>Legend <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>  final_combined_results<span class="sc">$</span>Legend, </span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"3%"</span>, <span class="st">"4%"</span>, <span class="st">"5%"</span>, <span class="st">"6%"</span>, <span class="st">"7%"</span>, <span class="st">"8%"</span>, <span class="st">"9%"</span>, <span class="st">"10%"</span>, <span class="st">"TRS Benefit"</span>)</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Withdrawals</span></span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a>withdrawal_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(final_combined_results, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Average_Withdrawal, <span class="at">color =</span> Legend, <span class="at">linetype =</span> Line_Type, <span class="at">group =</span> Legend)) <span class="sc">+</span></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"cyan"</span>, <span class="st">"brown"</span>, <span class="st">"pink"</span>, <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_identity</span>() <span class="sc">+</span></span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of ORP Withdrawals and TRS Benefits"</span>,</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of Retirement"</span>,</span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Withdrawal/Benefit ($)"</span>,</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Legend"</span></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>())</span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine Balance Results for Visualization</span></span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>combined_balance_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">seq_along</span>(all_balance_results), <span class="cf">function</span>(i) {</span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>  avg_balance <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(all_balance_results[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Compute average balances</span></span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> retirement_age<span class="sc">:</span>(death_age <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">Average_Balance =</span> avg_balance,</span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">Withdrawal_Rate =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(withdrawal_rates[i] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>)  <span class="co"># Match withdrawal rate</span></span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Balances</span></span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a>balance_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(combined_balance_results, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Average_Balance, <span class="at">color =</span> Withdrawal_Rate, <span class="at">group =</span> Withdrawal_Rate)) <span class="sc">+</span></span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"orange"</span>, <span class="st">"cyan"</span>, <span class="st">"brown"</span>, <span class="st">"pink"</span>)) <span class="sc">+</span></span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of ORP Balances Across Withdrawal Rates"</span>,</span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of Retirement"</span>,</span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average ORP Balance ($)"</span>,</span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Withdrawal Rate"</span></span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>())</span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Display Plots</span></span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a>withdrawal_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We clearly see that the TRS is a better model for retirement. The TRS benefit remains stable and increases over time due to inflation adjustments, providing a reliable income source for retirees. Also, we decided to compare the ORP withdrawals at different rates. Appreciating a huge gap just by changing one percent. Making it a clear factor when comes down to retirement planning.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>balance_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Also, we want to see the average balance of the ORP plan over time. The line graph illustrates the average ORP balances across different withdrawal rates over the retirement period. Key insights from the visualization are as follows:</p>
<ol type="1">
<li><strong>Withdrawal Rates</strong>:
<ul>
<li>The graph shows the average ORP balance for withdrawal rates ranging from 3% to 10%.</li>
<li>The 6% withdrawal rate maintains a stable balance over time, providing a consistent income stream for retirees, and still increase its value.</li>
<li>The 10% withdrawal rate depletes the ORP savings too quickly, indicating a high-risk strategy.</li>
<li>The 3% withdrawal rate is overly conservative, resulting in a slow depletion of savings and lower income.</li>
</ul></li>
</ol>
<p>This plan is recommended for those who want to have a stable income over time and may want to liquidate in the future or pass it on to their partners or children.</p>
<p>After getting this information, we want to make sure that the ORP plan is sustainable and will not run out of money before the retiree passes away. In that way, we would make sure that the retiree will have a stable income over time.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split orp_balances into a list based on withdrawal rates</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>orp_balances <span class="ot">&lt;-</span> <span class="fu">split</span>(orp_balances, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(withdrawal_rates), <span class="at">each =</span> years_in_retirement))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert each list element to a matrix for simulation</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>orp_balances <span class="ot">&lt;-</span> <span class="fu">lapply</span>(orp_balances, <span class="cf">function</span>(x) <span class="fu">matrix</span>(x, <span class="at">nrow =</span> <span class="dv">200</span>, <span class="at">ncol =</span> years_in_retirement))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate probabilities of exhaustion for each withdrawal rate</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>exhaust_probabilities <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_along</span>(withdrawal_rates), <span class="cf">function</span>(rate_index) {</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  current_balance <span class="ot">&lt;-</span> orp_balances[[rate_index]]  <span class="co"># Get balances for the current rate</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  exhausted <span class="ot">&lt;-</span> <span class="fu">apply</span>(current_balance, <span class="dv">1</span>, <span class="cf">function</span>(sim_row) <span class="fu">any</span>(sim_row[<span class="dv">1</span><span class="sc">:</span>(years_in_retirement <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">==</span> <span class="dv">0</span>))  <span class="co"># Check if exhausted</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(exhausted) <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># Return percentage of exhausted simulations</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for results</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>exhaustion_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Withdrawal_Rate =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(withdrawal_rates <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Probability =</span> <span class="fu">as.numeric</span>(<span class="fu">round</span>(exhaust_probabilities, <span class="dv">2</span>))</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the gt library for table formatting</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a formatted table with results</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>gt_exhaustion_table <span class="ot">&lt;-</span> exhaustion_table <span class="sc">|&gt;</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Probability of ORP Savings Exhaustion"</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Before Death by Withdrawal Rate"</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(Probability),  <span class="co"># Updated syntax</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimals =</span> <span class="dv">2</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">Withdrawal_Rate =</span> <span class="st">"Withdrawal Rate"</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">Probability =</span> <span class="st">"Exhaustion Probability (%)"</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_source_note</span>(</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">source_note =</span> <span class="st">"Data simulated using Monte Carlo bootstrapping."</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>gt_exhaustion_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="hdtqvntpzx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hdtqvntpzx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hdtqvntpzx thead, #hdtqvntpzx tbody, #hdtqvntpzx tfoot, #hdtqvntpzx tr, #hdtqvntpzx td, #hdtqvntpzx th {
  border-style: none;
}

#hdtqvntpzx p {
  margin: 0;
  padding: 0;
}

#hdtqvntpzx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hdtqvntpzx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hdtqvntpzx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hdtqvntpzx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hdtqvntpzx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hdtqvntpzx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hdtqvntpzx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hdtqvntpzx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hdtqvntpzx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hdtqvntpzx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hdtqvntpzx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hdtqvntpzx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hdtqvntpzx .gt_spanner_row {
  border-bottom-style: hidden;
}

#hdtqvntpzx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hdtqvntpzx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hdtqvntpzx .gt_from_md > :first-child {
  margin-top: 0;
}

#hdtqvntpzx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hdtqvntpzx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hdtqvntpzx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hdtqvntpzx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hdtqvntpzx .gt_row_group_first td {
  border-top-width: 2px;
}

#hdtqvntpzx .gt_row_group_first th {
  border-top-width: 2px;
}

#hdtqvntpzx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdtqvntpzx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hdtqvntpzx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hdtqvntpzx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hdtqvntpzx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdtqvntpzx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hdtqvntpzx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hdtqvntpzx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hdtqvntpzx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hdtqvntpzx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hdtqvntpzx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdtqvntpzx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hdtqvntpzx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hdtqvntpzx .gt_left {
  text-align: left;
}

#hdtqvntpzx .gt_center {
  text-align: center;
}

#hdtqvntpzx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hdtqvntpzx .gt_font_normal {
  font-weight: normal;
}

#hdtqvntpzx .gt_font_bold {
  font-weight: bold;
}

#hdtqvntpzx .gt_font_italic {
  font-style: italic;
}

#hdtqvntpzx .gt_super {
  font-size: 65%;
}

#hdtqvntpzx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hdtqvntpzx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hdtqvntpzx .gt_indent_1 {
  text-indent: 5px;
}

#hdtqvntpzx .gt_indent_2 {
  text-indent: 10px;
}

#hdtqvntpzx .gt_indent_3 {
  text-indent: 15px;
}

#hdtqvntpzx .gt_indent_4 {
  text-indent: 20px;
}

#hdtqvntpzx .gt_indent_5 {
  text-indent: 25px;
}

#hdtqvntpzx .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hdtqvntpzx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="2" class="gt_heading gt_title gt_font_normal">Probability of ORP Savings Exhaustion</th>
</tr>
<tr class="odd gt_heading">
<th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Before Death by Withdrawal Rate</th>
</tr>
<tr class="header gt_col_headings">
<th id="Withdrawal Rate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Withdrawal Rate</th>
<th id="Exhaustion Probability (%)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Exhaustion Probability (%)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">3%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">4%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">5%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">6%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">7%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">8%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">9%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">10%</td>
<td class="gt_row gt_right" headers="Probability">0.00</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="2" class="gt_sourcenote">Data simulated using Monte Carlo bootstrapping.</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>In all cases, the ORP plan is sustainable. However, we have to take into consideration that the models with a that 7 percent, would have a negative growth in terms of withdrawals. This means that the retiree would have to adjust the withdrawal rate to a lower percentage to make sure that the ORP plan is sustainable.</p>
<p>We want to keep digging on the ORP plan and see if the retiree would have a higher income than the TRS plan.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vector to store probabilities for each withdrawal rate</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>higher_income_probabilities <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(withdrawal_rates))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through withdrawal rates</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(withdrawal_rates)) {</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  rate <span class="ot">&lt;-</span> withdrawal_rates[i]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  higher_income_count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Iterate over years</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (year <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>years_in_retirement) {</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    higher_income_count <span class="ot">&lt;-</span> higher_income_count <span class="sc">+</span> <span class="fu">sum</span>(orp_withdrawals[, year] <span class="sc">&gt;</span> trs_benefits[, year])</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate probability</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  higher_income_probabilities[i] <span class="ot">&lt;-</span> higher_income_count <span class="sc">/</span> (<span class="dv">200</span> <span class="sc">*</span> years_in_retirement) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>higher_income_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Withdrawal_Rate =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(withdrawal_rates <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Probability =</span> <span class="fu">round</span>(higher_income_probabilities, <span class="dv">2</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>gt <span class="ot">&lt;-</span> <span class="fu">gt</span>(higher_income_table) <span class="sc">|&gt;</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Probability of Higher ORP Income vs. TRS Benefit"</span>,</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Based on Different Withdrawal Rates"</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">Withdrawal_Rate =</span> <span class="st">"Withdrawal Rate"</span>,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">Probability =</span> <span class="st">"Higher Income Probability (%)"</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_spanner</span>(<span class="at">label =</span> <span class="st">"Higher Income Probability (%)"</span>, <span class="at">columns =</span> <span class="fu">c</span>(<span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="st">"medium"</span>,</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">heading.align =</span> <span class="st">"center"</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>gt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="ddwskmyubs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ddwskmyubs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ddwskmyubs thead, #ddwskmyubs tbody, #ddwskmyubs tfoot, #ddwskmyubs tr, #ddwskmyubs td, #ddwskmyubs th {
  border-style: none;
}

#ddwskmyubs p {
  margin: 0;
  padding: 0;
}

#ddwskmyubs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: medium;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ddwskmyubs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ddwskmyubs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ddwskmyubs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ddwskmyubs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddwskmyubs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddwskmyubs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddwskmyubs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ddwskmyubs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ddwskmyubs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ddwskmyubs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ddwskmyubs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ddwskmyubs .gt_spanner_row {
  border-bottom-style: hidden;
}

#ddwskmyubs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ddwskmyubs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ddwskmyubs .gt_from_md > :first-child {
  margin-top: 0;
}

#ddwskmyubs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ddwskmyubs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ddwskmyubs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ddwskmyubs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ddwskmyubs .gt_row_group_first td {
  border-top-width: 2px;
}

#ddwskmyubs .gt_row_group_first th {
  border-top-width: 2px;
}

#ddwskmyubs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddwskmyubs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ddwskmyubs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ddwskmyubs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddwskmyubs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddwskmyubs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ddwskmyubs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ddwskmyubs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ddwskmyubs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddwskmyubs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddwskmyubs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddwskmyubs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddwskmyubs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddwskmyubs .gt_left {
  text-align: left;
}

#ddwskmyubs .gt_center {
  text-align: center;
}

#ddwskmyubs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ddwskmyubs .gt_font_normal {
  font-weight: normal;
}

#ddwskmyubs .gt_font_bold {
  font-weight: bold;
}

#ddwskmyubs .gt_font_italic {
  font-style: italic;
}

#ddwskmyubs .gt_super {
  font-size: 65%;
}

#ddwskmyubs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ddwskmyubs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ddwskmyubs .gt_indent_1 {
  text-indent: 5px;
}

#ddwskmyubs .gt_indent_2 {
  text-indent: 10px;
}

#ddwskmyubs .gt_indent_3 {
  text-indent: 15px;
}

#ddwskmyubs .gt_indent_4 {
  text-indent: 20px;
}

#ddwskmyubs .gt_indent_5 {
  text-indent: 25px;
}

#ddwskmyubs .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ddwskmyubs div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="2" class="gt_heading gt_title gt_font_normal">Probability of Higher ORP Income vs. TRS Benefit</th>
</tr>
<tr class="odd gt_heading">
<th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Based on Different Withdrawal Rates</th>
</tr>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="Withdrawal Rate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Withdrawal Rate</th>
<th id="Higher Income Probability (%)" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="col"><span class="gt_column_spanner">Higher Income Probability (%)</span></th>
</tr>
<tr class="odd gt_col_headings">
<th id="Higher Income Probability (%)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Higher Income Probability (%)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">3%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">4%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">5%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">6%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">7%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">8%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Withdrawal_Rate">9%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Withdrawal_Rate">10%</td>
<td class="gt_row gt_right" headers="Probability">24.5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As we can see, the percentage doesn’t change on all the withdrawal rates. This means that the OPR could have better months than the TRS. However, as we saw in the previous graphs, that just would happens if the retiree has a higher withdrawal rate and would just happens for the first few years.</p>
</section>
</section>
</section>
<section id="final-recommendations-for-opr" class="level1">
<h1>Final Recommendations for OPR</h1>
<p>Now we want to prove why our recommendation is 6% for the withdrawal rate.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the 6% withdrawal rate</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>rate_6_data <span class="ot">&lt;-</span> combined_withdrawal_results[combined_withdrawal_results<span class="sc">$</span>Withdrawal_Rate <span class="sc">==</span> <span class="st">"6%"</span>, ]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>rate_6_exhaust_prob <span class="ot">&lt;-</span> exhaustion_table[<span class="fu">which</span>(withdrawal_rates <span class="sc">==</span> <span class="fl">0.06</span>), <span class="st">"Probability"</span>]</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add TRS Results as a Data Frame</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>trs_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> retirement_age<span class="sc">:</span>(death_age <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Average_Withdrawal =</span> <span class="fu">colMeans</span>(trs_benefits, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Legend =</span> <span class="st">"TRS Benefit"</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Initial and Final Income for Each Program</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># For ORP (6% Withdrawal Rate)</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>orp_initial_income <span class="ot">&lt;-</span> rate_6_data<span class="sc">$</span>Average_Withdrawal[<span class="dv">1</span>]  <span class="co"># First year withdrawal</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>orp_income_death <span class="ot">&lt;-</span> <span class="fu">tail</span>(rate_6_data<span class="sc">$</span>Average_Withdrawal, <span class="dv">1</span>)  <span class="co"># Last year withdrawal</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>orp_difference <span class="ot">&lt;-</span> orp_income_death <span class="sc">-</span> orp_initial_income</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># For TRS</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>trs_initial_income <span class="ot">&lt;-</span> trs_data<span class="sc">$</span>Average_Withdrawal[<span class="dv">1</span>]  <span class="co"># First year benefit</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>trs_income_death <span class="ot">&lt;-</span> <span class="fu">tail</span>(trs_data<span class="sc">$</span>Average_Withdrawal, <span class="dv">1</span>)  <span class="co"># Last year benefit</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>trs_difference <span class="ot">&lt;-</span> trs_income_death <span class="sc">-</span> trs_initial_income</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Data Frame for the Table</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>income_comparison_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Plan =</span> <span class="fu">c</span>(<span class="st">"ORP (6% Withdrawal Rate)"</span>, <span class="st">"TRS Benefit"</span>),</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Initial_Income =</span> <span class="fu">c</span>(<span class="fu">round</span>(orp_initial_income, <span class="dv">2</span>), <span class="fu">round</span>(trs_initial_income, <span class="dv">2</span>)),</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Income_at_Death =</span> <span class="fu">c</span>(<span class="fu">round</span>(orp_income_death, <span class="dv">2</span>), <span class="fu">round</span>(trs_income_death, <span class="dv">2</span>))</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the Table Using `gt`</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>income_comparison_table <span class="sc">|&gt;</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Income Comparison Between ORP and TRS"</span>,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Initial and Final Income with Differences at Death"</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">Plan =</span> <span class="st">"Plan"</span>,</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">Initial_Income =</span> <span class="st">"Initial Income ($)"</span>,</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">Income_at_Death =</span> <span class="st">"Income at Death ($)"</span>,</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_currency</span>(</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(Initial_Income, Income_at_Death),</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">currency =</span> <span class="st">"USD"</span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="st">"medium"</span>,</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">heading.title.font.size =</span> <span class="st">"large"</span>,</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">heading.subtitle.font.size =</span> <span class="st">"medium"</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="yewccjknkc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yewccjknkc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yewccjknkc thead, #yewccjknkc tbody, #yewccjknkc tfoot, #yewccjknkc tr, #yewccjknkc td, #yewccjknkc th {
  border-style: none;
}

#yewccjknkc p {
  margin: 0;
  padding: 0;
}

#yewccjknkc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: medium;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yewccjknkc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yewccjknkc .gt_title {
  color: #333333;
  font-size: large;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yewccjknkc .gt_subtitle {
  color: #333333;
  font-size: medium;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yewccjknkc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yewccjknkc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yewccjknkc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yewccjknkc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yewccjknkc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yewccjknkc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yewccjknkc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yewccjknkc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yewccjknkc .gt_spanner_row {
  border-bottom-style: hidden;
}

#yewccjknkc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yewccjknkc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yewccjknkc .gt_from_md > :first-child {
  margin-top: 0;
}

#yewccjknkc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yewccjknkc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yewccjknkc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yewccjknkc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yewccjknkc .gt_row_group_first td {
  border-top-width: 2px;
}

#yewccjknkc .gt_row_group_first th {
  border-top-width: 2px;
}

#yewccjknkc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yewccjknkc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yewccjknkc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yewccjknkc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yewccjknkc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yewccjknkc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yewccjknkc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yewccjknkc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yewccjknkc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yewccjknkc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yewccjknkc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yewccjknkc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yewccjknkc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yewccjknkc .gt_left {
  text-align: left;
}

#yewccjknkc .gt_center {
  text-align: center;
}

#yewccjknkc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yewccjknkc .gt_font_normal {
  font-weight: normal;
}

#yewccjknkc .gt_font_bold {
  font-weight: bold;
}

#yewccjknkc .gt_font_italic {
  font-style: italic;
}

#yewccjknkc .gt_super {
  font-size: 65%;
}

#yewccjknkc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yewccjknkc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yewccjknkc .gt_indent_1 {
  text-indent: 5px;
}

#yewccjknkc .gt_indent_2 {
  text-indent: 10px;
}

#yewccjknkc .gt_indent_3 {
  text-indent: 15px;
}

#yewccjknkc .gt_indent_4 {
  text-indent: 20px;
}

#yewccjknkc .gt_indent_5 {
  text-indent: 25px;
}

#yewccjknkc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#yewccjknkc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="3" class="gt_heading gt_title gt_font_normal">Income Comparison Between ORP and TRS</th>
</tr>
<tr class="odd gt_heading">
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Initial and Final Income with Differences at Death</th>
</tr>
<tr class="header gt_col_headings">
<th id="Plan" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Plan</th>
<th id="Initial Income ($)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Initial Income ($)</th>
<th id="Income at Death ($)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Income at Death ($)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Plan">ORP (6% Withdrawal Rate)</td>
<td class="gt_row gt_right" headers="Initial_Income">$15,900.48</td>
<td class="gt_row gt_right" headers="Income_at_Death">$23,217.78</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Plan">TRS Benefit</td>
<td class="gt_row gt_right" headers="Initial_Income">$21,233.31</td>
<td class="gt_row gt_right" headers="Income_at_Death">$30,197.91</td>
</tr>
</tbody>
</table>

</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization: Compare 6% ORP withdrawals with TRS benefits</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> rate_6_data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Average_Withdrawal, <span class="at">color =</span> <span class="st">"6% Withdrawal Rate"</span>), <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> trs_data, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Average_Withdrawal, <span class="at">color =</span> Legend), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"6% Withdrawal Rate"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"TRS Benefit"</span> <span class="ot">=</span> <span class="st">"black"</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"6% Withdrawal Rate"</span>, <span class="st">"TRS Benefit"</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of 6% ORP Withdrawals and TRS Benefits"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year of Retirement"</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Withdrawal/Benefit ($)"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Legend"</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">dollar_format</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>After analyzing the ORP plan and comparing it with the TRS benefits, we can provide the following recommendations based on the simulation results: - The annual income of the retiree would be highly affected by the withdrawal rate. A 6% withdrawal rate would provide a stable income over time, ensuring the sustainability of the ORP plan. It would kind of simulate the TRS benefits in terms of growth and stability. But with a certain difference in income, to start, TRS has ~ 5 thousand of difference, and at the end, it has ~ 7 thousand of difference. But still is a the best option for the retiree.</p>
</section>
<section id="conclusions" class="level1">
<h1>Conclusions</h1>
<p>The analysis highlights that the Teachers Retirement System (TRS) offers superior income stability and inflation protection compared to the Optional Retirement Plan (ORP). TRS consistently provides higher annual income, starting at ~$1,769/month versus ORP’s ~$883/month (with the common suggested 4%), with the gap widening over time to ~$7,000 annually by the end of retirement.</p>
<p>The ORP plan, while offering flexibility and growth through compounding, requires careful management of withdrawal rates. A 6% withdrawal rate strikes the best balance, ensuring sustainability and consistent income. However, ORP withdrawals are not inflation-adjusted, leading to reduced purchasing power over time.</p>
<p>Recommendation: Choose TRS for stable, inflation-protected income. Opt for ORP if you value investment control and can manage withdrawal rates responsibly and if you want to leave money for your family. TRS remains the optimal choice for most retirees seeking long-term financial security.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/<GITHUB_NAME>\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>